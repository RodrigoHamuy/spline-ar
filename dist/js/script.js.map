{"version":3,"sources":["node_modules/browser-pack/_prelude.js","js/controls/OrbitControls.js","js/game/CameraManager.js","js/game/Game.js","js/game/NavTrackAgent.js","js/game/Player.js","js/game/PlayerCamera.js","js/game/SceneManager.js","js/game/TrackGeometry.js","js/game/TrackManager.js","js/game/WindowManager.js","js/script.js","vendor/EventDispatcher.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC1/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9HA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"script.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","/**\r\n * @author qiao / https://github.com/qiao\r\n * @author mrdoob / http://mrdoob.com\r\n * @author alteredq / http://alteredqualia.com/\r\n * @author WestLangley / http://github.com/WestLangley\r\n * @author erich666 / http://erichaines.com\r\n*/\r\n\r\n// This set of controls performs orbiting, dollying (zooming), and panning.\r\n// Unlike TrackballControls, it maintains the \"up\" direction object.up (+Y by default).\r\n//\r\n//    Orbit - left mouse / touch: one finger move\r\n//    Zoom - middle mouse, or mousewheel / touch: two finger spread or squish\r\n//    Pan - right mouse, or arrow keys / touch: three finter swipe\r\n\r\nfunction OrbitControls( object, domElement ) {\r\n\r\n\tthis.object = object;\r\n\r\n\tthis.domElement = ( domElement !== undefined ) ? domElement : document;\r\n\r\n\t// Set to false to disable this control\r\n\tthis.enabled = true;\r\n\r\n\t// \"target\" sets the location of focus, where the object orbits around\r\n\tthis.target = new THREE.Vector3();\r\n\r\n\t// How far you can dolly in and out ( PerspectiveCamera only )\r\n\tthis.minDistance = 0;\r\n\tthis.maxDistance = Infinity;\r\n\r\n\t// How far you can zoom in and out ( OrthographicCamera only )\r\n\tthis.minZoom = 0;\r\n\tthis.maxZoom = Infinity;\r\n\r\n\t// How far you can orbit vertically, upper and lower limits.\r\n\t// Range is 0 to Math.PI radians.\r\n\tthis.minPolarAngle = 0; // radians\r\n\tthis.maxPolarAngle = Math.PI; // radians\r\n\r\n\t// How far you can orbit horizontally, upper and lower limits.\r\n\t// If set, must be a sub-interval of the interval [ - Math.PI, Math.PI ].\r\n\tthis.minAzimuthAngle = - Infinity; // radians\r\n\tthis.maxAzimuthAngle = Infinity; // radians\r\n\r\n\t// Set to true to enable damping (inertia)\r\n\t// If damping is enabled, you must call controls.update() in your animation loop\r\n\tthis.enableDamping = false;\r\n\tthis.dampingFactor = 0.25;\r\n\r\n\t// This option actually enables dollying in and out; left as \"zoom\" for backwards compatibility.\r\n\t// Set to false to disable zooming\r\n\tthis.enableZoom = true;\r\n\tthis.zoomSpeed = 1.0;\r\n\r\n\t// Set to false to disable rotating\r\n\tthis.enableRotate = true;\r\n\tthis.rotateSpeed = 1.0;\r\n\r\n\t// Set to false to disable panning\r\n\tthis.enablePan = true;\r\n\tthis.keyPanSpeed = 7.0;\t// pixels moved per arrow key push\r\n\r\n\t// Set to true to automatically rotate around the target\r\n\t// If auto-rotate is enabled, you must call controls.update() in your animation loop\r\n\tthis.autoRotate = false;\r\n\tthis.autoRotateSpeed = 2.0; // 30 seconds per round when fps is 60\r\n\r\n\t// Set to false to disable use of the keys\r\n\tthis.enableKeys = true;\r\n\r\n\t// The four arrow keys\r\n\tthis.keys = { LEFT: 37, UP: 38, RIGHT: 39, BOTTOM: 40 };\r\n\r\n\t// Mouse buttons\r\n\tthis.mouseButtons = { ORBIT: THREE.MOUSE.LEFT, ZOOM: THREE.MOUSE.MIDDLE, PAN: THREE.MOUSE.RIGHT };\r\n\r\n\t// for reset\r\n\tthis.target0 = this.target.clone();\r\n\tthis.position0 = this.object.position.clone();\r\n\tthis.zoom0 = this.object.zoom;\r\n\r\n\t//\r\n\t// public methods\r\n\t//\r\n\r\n\tthis.getPolarAngle = function () {\r\n\r\n\t\treturn spherical.phi;\r\n\r\n\t};\r\n\r\n\tthis.getAzimuthalAngle = function () {\r\n\r\n\t\treturn spherical.theta;\r\n\r\n\t};\r\n\r\n\tthis.reset = function () {\r\n\r\n\t\tscope.target.copy( scope.target0 );\r\n\t\tscope.object.position.copy( scope.position0 );\r\n\t\tscope.object.zoom = scope.zoom0;\r\n\r\n\t\tscope.object.updateProjectionMatrix();\r\n\t\tscope.dispatchEvent( changeEvent );\r\n\r\n\t\tscope.update();\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t};\r\n\r\n\t// this method is exposed, but perhaps it would be better if we can make it private...\r\n\tthis.update = function() {\r\n\r\n\t\tvar offset = new THREE.Vector3();\r\n\r\n\t\t// so camera.up is the orbit axis\r\n\t\tvar quat = new THREE.Quaternion().setFromUnitVectors( object.up, new THREE.Vector3( 0, 1, 0 ) );\r\n\t\tvar quatInverse = quat.clone().inverse();\r\n\r\n\t\tvar lastPosition = new THREE.Vector3();\r\n\t\tvar lastQuaternion = new THREE.Quaternion();\r\n\r\n\t\treturn function update () {\r\n\r\n\t\t\tvar position = scope.object.position;\r\n\r\n\t\t\toffset.copy( position ).sub( scope.target );\r\n\r\n\t\t\t// rotate offset to \"y-axis-is-up\" space\r\n\t\t\toffset.applyQuaternion( quat );\r\n\r\n\t\t\t// angle from z-axis around y-axis\r\n\t\t\tspherical.setFromVector3( offset );\r\n\r\n\t\t\tif ( scope.autoRotate && state === STATE.NONE ) {\r\n\r\n\t\t\t\trotateLeft( getAutoRotationAngle() );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tspherical.theta += sphericalDelta.theta;\r\n\t\t\tspherical.phi += sphericalDelta.phi;\r\n\r\n\t\t\t// restrict theta to be between desired limits\r\n\t\t\tspherical.theta = Math.max( scope.minAzimuthAngle, Math.min( scope.maxAzimuthAngle, spherical.theta ) );\r\n\r\n\t\t\t// restrict phi to be between desired limits\r\n\t\t\tspherical.phi = Math.max( scope.minPolarAngle, Math.min( scope.maxPolarAngle, spherical.phi ) );\r\n\r\n\t\t\tspherical.makeSafe();\r\n\r\n\r\n\t\t\tspherical.radius *= scale;\r\n\r\n\t\t\t// restrict radius to be between desired limits\r\n\t\t\tspherical.radius = Math.max( scope.minDistance, Math.min( scope.maxDistance, spherical.radius ) );\r\n\r\n\t\t\t// move target to panned location\r\n\t\t\tscope.target.add( panOffset );\r\n\r\n\t\t\toffset.setFromSpherical( spherical );\r\n\r\n\t\t\t// rotate offset back to \"camera-up-vector-is-up\" space\r\n\t\t\toffset.applyQuaternion( quatInverse );\r\n\r\n\t\t\tposition.copy( scope.target ).add( offset );\r\n\r\n\t\t\tscope.object.lookAt( scope.target );\r\n\r\n\t\t\tif ( scope.enableDamping === true ) {\r\n\r\n\t\t\t\tsphericalDelta.theta *= ( 1 - scope.dampingFactor );\r\n\t\t\t\tsphericalDelta.phi *= ( 1 - scope.dampingFactor );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tsphericalDelta.set( 0, 0, 0 );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tscale = 1;\r\n\t\t\tpanOffset.set( 0, 0, 0 );\r\n\r\n\t\t\t// update condition is:\r\n\t\t\t// min(camera displacement, camera rotation in radians)^2 > EPS\r\n\t\t\t// using small-angle approximation cos(x/2) = 1 - x^2 / 8\r\n\r\n\t\t\tif ( zoomChanged ||\r\n\t\t\t\tlastPosition.distanceToSquared( scope.object.position ) > EPS ||\r\n\t\t\t\t8 * ( 1 - lastQuaternion.dot( scope.object.quaternion ) ) > EPS ) {\r\n\r\n\t\t\t\tscope.dispatchEvent( changeEvent );\r\n\r\n\t\t\t\tlastPosition.copy( scope.object.position );\r\n\t\t\t\tlastQuaternion.copy( scope.object.quaternion );\r\n\t\t\t\tzoomChanged = false;\r\n\r\n\t\t\t\treturn true;\r\n\r\n\t\t\t}\r\n\r\n\t\t\treturn false;\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tthis.dispose = function() {\r\n\r\n\t\tscope.domElement.removeEventListener( 'contextmenu', onContextMenu, false );\r\n\t\tscope.domElement.removeEventListener( 'mousedown', onMouseDown, false );\r\n\t\tscope.domElement.removeEventListener( 'wheel', onMouseWheel, false );\r\n\r\n\t\tscope.domElement.removeEventListener( 'touchstart', onTouchStart, false );\r\n\t\tscope.domElement.removeEventListener( 'touchend', onTouchEnd, false );\r\n\t\tscope.domElement.removeEventListener( 'touchmove', onTouchMove, false );\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\r\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\r\n\r\n\t\twindow.removeEventListener( 'keydown', onKeyDown, false );\r\n\r\n\t\t//scope.dispatchEvent( { type: 'dispose' } ); // should this be added here?\r\n\r\n\t};\r\n\r\n\t//\r\n\t// internals\r\n\t//\r\n\r\n\tvar scope = this;\r\n\r\n\tvar changeEvent = { type: 'change' };\r\n\tvar startEvent = { type: 'start' };\r\n\tvar endEvent = { type: 'end' };\r\n\r\n\tvar STATE = { NONE : - 1, ROTATE : 0, DOLLY : 1, PAN : 2, TOUCH_ROTATE : 3, TOUCH_DOLLY : 4, TOUCH_PAN : 5 };\r\n\r\n\tvar state = STATE.NONE;\r\n\r\n\tvar EPS = 0.000001;\r\n\r\n\t// current position in spherical coordinates\r\n\tvar spherical = new THREE.Spherical();\r\n\tvar sphericalDelta = new THREE.Spherical();\r\n\r\n\tvar scale = 1;\r\n\tvar panOffset = new THREE.Vector3();\r\n\tvar zoomChanged = false;\r\n\r\n\tvar rotateStart = new THREE.Vector2();\r\n\tvar rotateEnd = new THREE.Vector2();\r\n\tvar rotateDelta = new THREE.Vector2();\r\n\r\n\tvar panStart = new THREE.Vector2();\r\n\tvar panEnd = new THREE.Vector2();\r\n\tvar panDelta = new THREE.Vector2();\r\n\r\n\tvar dollyStart = new THREE.Vector2();\r\n\tvar dollyEnd = new THREE.Vector2();\r\n\tvar dollyDelta = new THREE.Vector2();\r\n\r\n\tfunction getAutoRotationAngle() {\r\n\r\n\t\treturn 2 * Math.PI / 60 / 60 * scope.autoRotateSpeed;\r\n\r\n\t}\r\n\r\n\tfunction getZoomScale() {\r\n\r\n\t\treturn Math.pow( 0.95, scope.zoomSpeed );\r\n\r\n\t}\r\n\r\n\tfunction rotateLeft( angle ) {\r\n\r\n\t\tsphericalDelta.theta -= angle;\r\n\r\n\t}\r\n\r\n\tfunction rotateUp( angle ) {\r\n\r\n\t\tsphericalDelta.phi -= angle;\r\n\r\n\t}\r\n\r\n\tvar panLeft = function() {\r\n\r\n\t\tvar v = new THREE.Vector3();\r\n\r\n\t\treturn function panLeft( distance, objectMatrix ) {\r\n\r\n\t\t\tv.setFromMatrixColumn( objectMatrix, 0 ); // get X column of objectMatrix\r\n\t\t\tv.multiplyScalar( - distance );\r\n\r\n\t\t\tpanOffset.add( v );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tvar panUp = function() {\r\n\r\n\t\tvar v = new THREE.Vector3();\r\n\r\n\t\treturn function panUp( distance, objectMatrix ) {\r\n\r\n\t\t\tv.setFromMatrixColumn( objectMatrix, 1 ); // get Y column of objectMatrix\r\n\t\t\tv.multiplyScalar( distance );\r\n\r\n\t\t\tpanOffset.add( v );\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\t// deltaX and deltaY are in pixels; right and down are positive\r\n\tvar pan = function() {\r\n\r\n\t\tvar offset = new THREE.Vector3();\r\n\r\n\t\treturn function pan ( deltaX, deltaY ) {\r\n\r\n\t\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\r\n\t\t\tif ( scope.object instanceof THREE.PerspectiveCamera ) {\r\n\r\n\t\t\t\t// perspective\r\n\t\t\t\tvar position = scope.object.position;\r\n\t\t\t\toffset.copy( position ).sub( scope.target );\r\n\t\t\t\tvar targetDistance = offset.length();\r\n\r\n\t\t\t\t// half of the fov is center to top of screen\r\n\t\t\t\ttargetDistance *= Math.tan( ( scope.object.fov / 2 ) * Math.PI / 180.0 );\r\n\r\n\t\t\t\t// we actually don't use screenWidth, since perspective camera is fixed to screen height\r\n\t\t\t\tpanLeft( 2 * deltaX * targetDistance / element.clientHeight, scope.object.matrix );\r\n\t\t\t\tpanUp( 2 * deltaY * targetDistance / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t} else if ( scope.object instanceof THREE.OrthographicCamera ) {\r\n\r\n\t\t\t\t// orthographic\r\n\t\t\t\tpanLeft( deltaX * ( scope.object.right - scope.object.left ) / scope.object.zoom / element.clientWidth, scope.object.matrix );\r\n\t\t\t\tpanUp( deltaY * ( scope.object.top - scope.object.bottom ) / scope.object.zoom / element.clientHeight, scope.object.matrix );\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// camera neither orthographic nor perspective\r\n\t\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.' );\r\n\t\t\t\tscope.enablePan = false;\r\n\r\n\t\t\t}\r\n\r\n\t\t};\r\n\r\n\t}();\r\n\r\n\tfunction dollyIn( dollyScale ) {\r\n\r\n\t\tif ( scope.object instanceof THREE.PerspectiveCamera ) {\r\n\r\n\t\t\tscale /= dollyScale;\r\n\r\n\t\t} else if ( scope.object instanceof THREE.OrthographicCamera ) {\r\n\r\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom * dollyScale ) );\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\tscope.enableZoom = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction dollyOut( dollyScale ) {\r\n\r\n\t\tif ( scope.object instanceof THREE.PerspectiveCamera ) {\r\n\r\n\t\t\tscale *= dollyScale;\r\n\r\n\t\t} else if ( scope.object instanceof THREE.OrthographicCamera ) {\r\n\r\n\t\t\tscope.object.zoom = Math.max( scope.minZoom, Math.min( scope.maxZoom, scope.object.zoom / dollyScale ) );\r\n\t\t\tscope.object.updateProjectionMatrix();\r\n\t\t\tzoomChanged = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconsole.warn( 'WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled.' );\r\n\t\t\tscope.enableZoom = false;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\t//\r\n\t// event callbacks - update the object state\r\n\t//\r\n\r\n\tfunction handleMouseDownRotate( event ) {\r\n\r\n\t\t//console.log( 'handleMouseDownRotate' );\r\n\r\n\t\trotateStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseDownDolly( event ) {\r\n\r\n\t\t//console.log( 'handleMouseDownDolly' );\r\n\r\n\t\tdollyStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseDownPan( event ) {\r\n\r\n\t\t//console.log( 'handleMouseDownPan' );\r\n\r\n\t\tpanStart.set( event.clientX, event.clientY );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMoveRotate( event ) {\r\n\r\n\t\t//console.log( 'handleMouseMoveRotate' );\r\n\r\n\t\trotateEnd.set( event.clientX, event.clientY );\r\n\t\trotateDelta.subVectors( rotateEnd, rotateStart );\r\n\r\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\r\n\t\t// rotating across whole screen goes 360 degrees around\r\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\r\n\r\n\t\t// rotating up and down along whole screen attempts to go 360, but limited to 180\r\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\r\n\r\n\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMoveDolly( event ) {\r\n\r\n\t\t//console.log( 'handleMouseMoveDolly' );\r\n\r\n\t\tdollyEnd.set( event.clientX, event.clientY );\r\n\r\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\r\n\r\n\t\tif ( dollyDelta.y > 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t} else if ( dollyDelta.y < 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseMovePan( event ) {\r\n\r\n\t\t//console.log( 'handleMouseMovePan' );\r\n\r\n\t\tpanEnd.set( event.clientX, event.clientY );\r\n\r\n\t\tpanDelta.subVectors( panEnd, panStart );\r\n\r\n\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\tpanStart.copy( panEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleMouseUp( event ) {\r\n\r\n\t\t//console.log( 'handleMouseUp' );\r\n\r\n\t}\r\n\r\n\tfunction handleMouseWheel( event ) {\r\n\r\n\t\t//console.log( 'handleMouseWheel' );\r\n\r\n\t\tif ( event.deltaY < 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t} else if ( event.deltaY > 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleKeyDown( event ) {\r\n\r\n\t\t//console.log( 'handleKeyDown' );\r\n\r\n\t\tswitch ( event.keyCode ) {\r\n\r\n\t\t\tcase scope.keys.UP:\r\n\t\t\t\tpan( 0, scope.keyPanSpeed );\r\n\t\t\t\tscope.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.BOTTOM:\r\n\t\t\t\tpan( 0, - scope.keyPanSpeed );\r\n\t\t\t\tscope.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.LEFT:\r\n\t\t\t\tpan( scope.keyPanSpeed, 0 );\r\n\t\t\t\tscope.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase scope.keys.RIGHT:\r\n\t\t\t\tpan( - scope.keyPanSpeed, 0 );\r\n\t\t\t\tscope.update();\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartRotate( event ) {\r\n\r\n\t\t//console.log( 'handleTouchStartRotate' );\r\n\r\n\t\trotateStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartDolly( event ) {\r\n\r\n\t\t//console.log( 'handleTouchStartDolly' );\r\n\r\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\r\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\tdollyStart.set( 0, distance );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchStartPan( event ) {\r\n\r\n\t\t//console.log( 'handleTouchStartPan' );\r\n\r\n\t\tpanStart.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveRotate( event ) {\r\n\r\n\t\t//console.log( 'handleTouchMoveRotate' );\r\n\r\n\t\trotateEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\t\trotateDelta.subVectors( rotateEnd, rotateStart );\r\n\r\n\t\tvar element = scope.domElement === document ? scope.domElement.body : scope.domElement;\r\n\r\n\t\t// rotating across whole screen goes 360 degrees around\r\n\t\trotateLeft( 2 * Math.PI * rotateDelta.x / element.clientWidth * scope.rotateSpeed );\r\n\r\n\t\t// rotating up and down along whole screen attempts to go 360, but limited to 180\r\n\t\trotateUp( 2 * Math.PI * rotateDelta.y / element.clientHeight * scope.rotateSpeed );\r\n\r\n\t\trotateStart.copy( rotateEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMoveDolly( event ) {\r\n\r\n\t\t//console.log( 'handleTouchMoveDolly' );\r\n\r\n\t\tvar dx = event.touches[ 0 ].pageX - event.touches[ 1 ].pageX;\r\n\t\tvar dy = event.touches[ 0 ].pageY - event.touches[ 1 ].pageY;\r\n\r\n\t\tvar distance = Math.sqrt( dx * dx + dy * dy );\r\n\r\n\t\tdollyEnd.set( 0, distance );\r\n\r\n\t\tdollyDelta.subVectors( dollyEnd, dollyStart );\r\n\r\n\t\tif ( dollyDelta.y > 0 ) {\r\n\r\n\t\t\tdollyOut( getZoomScale() );\r\n\r\n\t\t} else if ( dollyDelta.y < 0 ) {\r\n\r\n\t\t\tdollyIn( getZoomScale() );\r\n\r\n\t\t}\r\n\r\n\t\tdollyStart.copy( dollyEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleTouchMovePan( event ) {\r\n\r\n\t\t//console.log( 'handleTouchMovePan' );\r\n\r\n\t\tpanEnd.set( event.touches[ 0 ].pageX, event.touches[ 0 ].pageY );\r\n\r\n\t\tpanDelta.subVectors( panEnd, panStart );\r\n\r\n\t\tpan( panDelta.x, panDelta.y );\r\n\r\n\t\tpanStart.copy( panEnd );\r\n\r\n\t\tscope.update();\r\n\r\n\t}\r\n\r\n\tfunction handleTouchEnd( event ) {\r\n\r\n\t\t//console.log( 'handleTouchEnd' );\r\n\r\n\t}\r\n\r\n\t//\r\n\t// event handlers - FSM: listen for events and reset state\r\n\t//\r\n\r\n\tfunction onMouseDown( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif ( event.button === scope.mouseButtons.ORBIT ) {\r\n\r\n\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\thandleMouseDownRotate( event );\r\n\r\n\t\t\tstate = STATE.ROTATE;\r\n\r\n\t\t} else if ( event.button === scope.mouseButtons.ZOOM ) {\r\n\r\n\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\thandleMouseDownDolly( event );\r\n\r\n\t\t\tstate = STATE.DOLLY;\r\n\r\n\t\t} else if ( event.button === scope.mouseButtons.PAN ) {\r\n\r\n\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\thandleMouseDownPan( event );\r\n\r\n\t\t\tstate = STATE.PAN;\r\n\r\n\t\t}\r\n\r\n\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\tdocument.addEventListener( 'mousemove', onMouseMove, false );\r\n\t\t\tdocument.addEventListener( 'mouseup', onMouseUp, false );\r\n\r\n\t\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tif ( state === STATE.ROTATE ) {\r\n\r\n\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\thandleMouseMoveRotate( event );\r\n\r\n\t\t} else if ( state === STATE.DOLLY ) {\r\n\r\n\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\thandleMouseMoveDolly( event );\r\n\r\n\t\t} else if ( state === STATE.PAN ) {\r\n\r\n\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\thandleMouseMovePan( event );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onMouseUp( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\thandleMouseUp( event );\r\n\r\n\t\tdocument.removeEventListener( 'mousemove', onMouseMove, false );\r\n\t\tdocument.removeEventListener( 'mouseup', onMouseUp, false );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t}\r\n\r\n\tfunction onMouseWheel( event ) {\r\n\r\n\t\tif ( scope.enabled === false || scope.enableZoom === false || ( state !== STATE.NONE && state !== STATE.ROTATE ) ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\thandleMouseWheel( event );\r\n\r\n\t\tscope.dispatchEvent( startEvent ); // not sure why these are here...\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t}\r\n\r\n\tfunction onKeyDown( event ) {\r\n\r\n\t\tif ( scope.enabled === false || scope.enableKeys === false || scope.enablePan === false ) return;\r\n\r\n\t\thandleKeyDown( event );\r\n\r\n\t}\r\n\r\n\tfunction onTouchStart( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1:\t// one-fingered touch: rotate\r\n\r\n\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\r\n\t\t\t\thandleTouchStartRotate( event );\r\n\r\n\t\t\t\tstate = STATE.TOUCH_ROTATE;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2:\t// two-fingered touch: dolly\r\n\r\n\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\r\n\t\t\t\thandleTouchStartDolly( event );\r\n\r\n\t\t\t\tstate = STATE.TOUCH_DOLLY;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3: // three-fingered touch: pan\r\n\r\n\t\t\t\tif ( scope.enablePan === false ) return;\r\n\r\n\t\t\t\thandleTouchStartPan( event );\r\n\r\n\t\t\t\tstate = STATE.TOUCH_PAN;\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t\tif ( state !== STATE.NONE ) {\r\n\r\n\t\t\tscope.dispatchEvent( startEvent );\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onTouchMove( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tswitch ( event.touches.length ) {\r\n\r\n\t\t\tcase 1: // one-fingered touch: rotate\r\n\r\n\t\t\t\tif ( scope.enableRotate === false ) return;\r\n\t\t\t\tif ( state !== STATE.TOUCH_ROTATE ) return; // is this needed?...\r\n\r\n\t\t\t\thandleTouchMoveRotate( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 2: // two-fingered touch: dolly\r\n\r\n\t\t\t\tif ( scope.enableZoom === false ) return;\r\n\t\t\t\tif ( state !== STATE.TOUCH_DOLLY ) return; // is this needed?...\r\n\r\n\t\t\t\thandleTouchMoveDolly( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 3: // three-fingered touch: pan\r\n\r\n\t\t\t\tif ( scope.enablePan === false ) return;\r\n\t\t\t\tif ( state !== STATE.TOUCH_PAN ) return; // is this needed?...\r\n\r\n\t\t\t\thandleTouchMovePan( event );\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\r\n\t\t\t\tstate = STATE.NONE;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tfunction onTouchEnd( event ) {\r\n\r\n\t\tif ( scope.enabled === false ) return;\r\n\r\n\t\thandleTouchEnd( event );\r\n\r\n\t\tscope.dispatchEvent( endEvent );\r\n\r\n\t\tstate = STATE.NONE;\r\n\r\n\t}\r\n\r\n\tfunction onContextMenu( event ) {\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t}\r\n\r\n\t//\r\n\r\n\tscope.domElement.addEventListener( 'contextmenu', onContextMenu, false );\r\n\r\n\tscope.domElement.addEventListener( 'mousedown', onMouseDown, false );\r\n\tscope.domElement.addEventListener( 'wheel', onMouseWheel, false );\r\n\r\n\tscope.domElement.addEventListener( 'touchstart', onTouchStart, false );\r\n\tscope.domElement.addEventListener( 'touchend', onTouchEnd, false );\r\n\tscope.domElement.addEventListener( 'touchmove', onTouchMove, false );\r\n\r\n\twindow.addEventListener( 'keydown', onKeyDown, false );\r\n\r\n\t// force an update at start\r\n\r\n\tthis.update();\r\n\r\n};\r\n\r\nOrbitControls.prototype = Object.create( THREE.EventDispatcher.prototype );\r\nOrbitControls.prototype.constructor = OrbitControls;\r\n\r\nObject.defineProperties( OrbitControls.prototype, {\r\n\r\n\tcenter: {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .center has been renamed to .target' );\r\n\t\t\treturn this.target;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\t// backward compatibility\r\n\r\n\tnoZoom: {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\r\n\t\t\treturn ! this.enableZoom;\r\n\r\n\t\t},\r\n\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noZoom has been deprecated. Use .enableZoom instead.' );\r\n\t\t\tthis.enableZoom = ! value;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tnoRotate: {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\r\n\t\t\treturn ! this.enableRotate;\r\n\r\n\t\t},\r\n\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noRotate has been deprecated. Use .enableRotate instead.' );\r\n\t\t\tthis.enableRotate = ! value;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tnoPan: {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\r\n\t\t\treturn ! this.enablePan;\r\n\r\n\t\t},\r\n\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noPan has been deprecated. Use .enablePan instead.' );\r\n\t\t\tthis.enablePan = ! value;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tnoKeys: {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\r\n\t\t\treturn ! this.enableKeys;\r\n\r\n\t\t},\r\n\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .noKeys has been deprecated. Use .enableKeys instead.' );\r\n\t\t\tthis.enableKeys = ! value;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tstaticMoving : {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\r\n\t\t\treturn ! this.enableDamping;\r\n\r\n\t\t},\r\n\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .staticMoving has been deprecated. Use .enableDamping instead.' );\r\n\t\t\tthis.enableDamping = ! value;\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tdynamicDampingFactor : {\r\n\r\n\t\tget: function () {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\r\n\t\t\treturn this.dampingFactor;\r\n\r\n\t\t},\r\n\r\n\t\tset: function ( value ) {\r\n\r\n\t\t\tconsole.warn( 'THREE.OrbitControls: .dynamicDampingFactor has been renamed. Use .dampingFactor instead.' );\r\n\t\t\tthis.dampingFactor = value;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n} );\r\n\r\nmodule.exports = OrbitControls;\r\n","let\r\nOrbitControls = require( '../controls/OrbitControls' );\r\n\r\nclass CameraManager {\r\n\r\n  constructor() {\r\n\r\n    let\r\n    viewAngle = 45,\r\n    aspectRatio = window.innerWidth / window.innerHeight,\r\n    near = 1,\r\n    far = 10000;\r\n\r\n    this.camera = new THREE.PerspectiveCamera(\r\n      viewAngle, aspectRatio, near, far\r\n    );\r\n    this.camera.position.z = 300;\r\n\r\n    let controls = new OrbitControls( this.camera );\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = CameraManager;\r\n","let\r\nWindowManager = require( './WindowManager.js' ),\r\nPlayer = require( './Player.js' ),\r\nSceneManager = require( './SceneManager.js' ),\r\nCameraManager = require( './CameraManager' ),\r\nTrackManager = require( './TrackManager' ),\r\nNavTrackAgent = require( './NavTrackAgent' ),\r\nPlayerCamera = require( './PlayerCamera' );\r\n\r\nclass Game {\r\n\r\n  constructor() {\r\n\r\n    this.cubes = [];\r\n\r\n    THREE.ARUtils.getARDisplay().then(this.init.bind(this));\r\n\r\n    this.trackManager = new TrackManager();\r\n    this.trackManager.addEventListener('newSpline', this.newCubeGroup.bind(this));\r\n    // this.windowManager = new WindowManager();\r\n    // this.sceneManager = new SceneManager();\r\n    // let cameraManager = new CameraManager();\r\n    // this.clock = new THREE.Clock();\r\n    //\r\n    // this.windowManager.scene = this.sceneManager.scene;\r\n    // this.windowManager.camera = cameraManager.camera;\r\n    //\r\n    // this.trackManager.requestTrackData()\r\n    // .then( this.onTrackLoad.bind( this ) );\r\n\r\n  }\r\n\r\n  newCubeGroup(){\r\n    this.cubes = [];\r\n  }\r\n\r\n  init(display){\r\n\r\n    if (display === null) {\r\n      THREE.ARUtils.displayUnsupportedMessage();\r\n      return;\r\n    }\r\n    var dom = document.getElementById( 'container' );\r\n    this.vrDisplay = display;\r\n    this.renderer = new THREE.WebGLRenderer({ alpha: true });\r\n    this.scene = new THREE.Scene();\r\n    this.renderer.setPixelRatio(window.devicePixelRatio);\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n    this.renderer.autoClear = false;\r\n    dom.appendChild( this.renderer.domElement );\r\n    window.addEventListener('resize', this.onWindowResize.bind(this), false);\r\n\r\n    this.vrFrameData = new VRFrameData();\r\n\r\n    this.arView = new THREE.ARView(this.vrDisplay, this.renderer);\r\n    this.camera = new THREE.ARPerspectiveCamera(\r\n      this.vrDisplay,\r\n      60,\r\n      window.innerWidth / window.innerHeight,\r\n      this.vrDisplay.depthNear,\r\n      this.vrDisplay.depthFar\r\n    );\r\n    this.vrControls = new THREE.VRControls(this.camera);\r\n\r\n    this.createBoxTemplate();\r\n\r\n    this.renderer.domElement.addEventListener('touchstart', this.onClick.bind(this), false);\r\n\r\n    this.update();\r\n  }\r\n\r\n  createBoxTemplate(){\r\n\r\n    var colors = [\r\n      new THREE.Color( 0xffffff ),\r\n      new THREE.Color( 0xffff00 ),\r\n      new THREE.Color( 0xff00ff ),\r\n      new THREE.Color( 0xff0000 ),\r\n      new THREE.Color( 0x00ffff ),\r\n      new THREE.Color( 0x00ff00 ),\r\n      new THREE.Color( 0x0000ff ),\r\n      new THREE.Color( 0x000000 )\r\n    ];\r\n\r\n    var geometry = new THREE.BoxGeometry( 0.025, 0.05, 0.025 );\r\n    var faceIndices = ['a', 'b', 'c'];\r\n    for (var i = 0; i < geometry.faces.length; i++) {\r\n      var f  = geometry.faces[i];\r\n      for (var j = 0; j < 3; j++) {\r\n        var vertexIndex = f[faceIndices[ j ]];\r\n        f.vertexColors[j] = colors[vertexIndex];\r\n      }\r\n    }\r\n    var material = new THREE.MeshBasicMaterial({ vertexColors: THREE.VertexColors });\r\n    this.cube = new THREE.Mesh(geometry, material);\r\n\r\n  }\r\n\r\n  onClick(){\r\n    // Fetch the pose data from the current frame\r\n    var pose = this.vrFrameData.pose;\r\n\r\n    // Convert the pose orientation and position into\r\n    // THREE.Quaternion and THREE.Vector3 respectively\r\n    var ori = new THREE.Quaternion(\r\n      pose.orientation[0],\r\n      pose.orientation[1],\r\n      pose.orientation[2],\r\n      pose.orientation[3]\r\n    );\r\n\r\n    var pos = new THREE.Vector3(\r\n      pose.position[0],\r\n      pose.position[1],\r\n      pose.position[2]\r\n    );\r\n\r\n    var dirMtx = new THREE.Matrix4();\r\n    dirMtx.makeRotationFromQuaternion(ori);\r\n\r\n    var push = new THREE.Vector3(0, 0, -1.0);\r\n    push.transformDirection(dirMtx);\r\n    pos.addScaledVector(push, 0.125);\r\n\r\n    // Clone our cube object and place it at the camera's\r\n    // current position\r\n    var clone = this.cube.clone();\r\n\r\n    clone.position.copy(pos);\r\n    clone.quaternion.copy(ori);\r\n    this.cubes.push(clone);\r\n\r\n    if(this.cubes.length < 4){\r\n      this.scene.add(clone);\r\n\r\n    }else if (this.cubes.length === 4){\r\n      for (var i = 0; i < this.cubes.length-1; i++) {\r\n        var cube = this.cubes[i];\r\n        this.scene.remove( this.scene.getObjectById(cube.id));\r\n      }\r\n    }\r\n\r\n    this.updateSpline();\r\n\r\n  }\r\n\r\n  updateSpline(){\r\n    console.log(this.cubes[this.cubes.length-1].position);\r\n    if(this.cubes.length > 3){\r\n\r\n      this.trackManager.updateCtrlPoints( this.cubes );\r\n\r\n      if( this.trackManager.mesh === undefined ){\r\n\r\n        this.trackManager.createPath();\r\n        this.scene.add( this.trackManager.mesh );\r\n\r\n      }else{\r\n\r\n        this.trackManager.updatePath();\r\n\r\n      }\n      // this.trackManager.requestTrackData()\r\n      // .then( ()=>{\r\n      //   this.scene.add( this.trackManager.mesh );\r\n      // } );\r\n    }\r\n  }\r\n\r\n  update(){\r\n    this.arView.render();\r\n    this.camera.updateProjectionMatrix();\r\n    this.vrDisplay.getFrameData(this.vrFrameData);\r\n    this.vrControls.update();\r\n    this.renderer.clearDepth();\r\n    this.renderer.render(this.scene, this.camera);\r\n    this.vrDisplay.requestAnimationFrame(this.update.bind(this));\r\n  }\r\n\r\n  onTrackLoad() {\r\n\r\n    this.navTrackAgent = new NavTrackAgent( this );\r\n    this.player = new Player( this.navTrackAgent );\r\n    this.playerCamera = new PlayerCamera( this );\r\n\r\n    this.player.track = this.trackManager.mesh;\r\n    this.player.updatePosition();\r\n\r\n    this.sceneManager.scene.add( this.trackManager.mesh );\r\n    this.sceneManager.scene.add( this.player.mesh );\r\n\r\n    this.windowManager.render();\r\n\r\n  }\r\n\r\n  getDeltaTime() {\r\n\r\n    return this.clock.getDelta();\r\n\r\n  }\r\n\r\n  onWindowResize(){\r\n    this.camera.aspect = window.innerWidth / window.innerHeight;\r\n    this.camera.updateProjectionMatrix();\r\n    this.renderer.setSize(window.innerWidth, window.innerHeight);\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Game;\r\n","let EventDispatcher = require( '../../vendor/EventDispatcher.js' );\r\n\r\nclass NavTrackAgent extends EventDispatcher {\r\n\r\n  constructor( game ) {\r\n\r\n    super();\r\n\r\n    this.game = game;\r\n    this.track = game.trackManager;\r\n    this._currentDistance = 0;\r\n\r\n    this.speed = 150;\r\n\r\n    game.windowManager.addEventListener( 'onPreRender', this.update.bind( this ) );\r\n\r\n  }\r\n\r\n  update() {\r\n\r\n    this.currentDistance = (\r\n      this._currentDistance + this.speed * this.game.getDeltaTime()\r\n    ) % this.track.getLength();\r\n\r\n  }\r\n\r\n  get currentDistance() {\r\n\r\n    return this._currentDistance;\r\n\r\n  }\r\n\r\n  set currentDistance( value ) {\r\n\r\n    this._currentDistance = value;\r\n    this.dispatchEvent( { type: 'change' } );\r\n\r\n  }\r\n\r\n  get amountTraveled() {\r\n\r\n    return this._currentDistance / this.track.getLength();\r\n\r\n  }\r\n\r\n  nextAmountTraveled( add ) {\r\n\r\n    var next = ( this._currentDistance + add ) / this.track.getLength();\r\n\r\n    return next < 1 ? next : 1;\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = NavTrackAgent;\r\n","class Player {\r\n\r\n  constructor ( navTrackAgent ) {\r\n\r\n    this.navTrackAgent = navTrackAgent;\r\n\r\n    var geometry = new THREE.BoxGeometry( 1, 3, 10 );\r\n    var material = new THREE.MeshBasicMaterial( {color: 0x00ff00} );\r\n    this.mesh = new THREE.Mesh( geometry, material );\r\n\r\n    this.mesh.add( new THREE.AxisHelper( 20 ) );\r\n\r\n    this.navTrackAgent.addEventListener(\r\n      'change',\r\n      this.updatePosition.bind( this )\r\n    );\r\n\r\n  }\r\n\r\n  updatePosition() {\r\n\r\n    var amountTraveled = this.navTrackAgent.amountTraveled;\r\n\r\n    var pos = this.track.geometry.getPointAt( amountTraveled );\r\n\r\n    var normal = this.track.geometry.getNormalAt( amountTraveled );\r\n\r\n    var forward = this.track.geometry.getTangent( amountTraveled );\r\n\r\n    this.mesh.position.copy( pos )\r\n    .add(\r\n      new THREE.Vector3()\r\n      .addScaledVector( normal, 10 )\r\n    );\r\n\r\n    this.mesh.up = normal;\r\n\r\n    var m1 = new THREE.Matrix4();\r\n    m1.lookAt( forward, new THREE.Vector3(), normal );\r\n    this.mesh.quaternion.setFromRotationMatrix( m1 );\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = Player;\r\n","class PlayerCamera {\r\n\r\n  constructor( game ) {\r\n\r\n    this.margin = {\r\n      back: -20,\r\n      top: 20\r\n    };\r\n\r\n    this.game = game;\r\n    this.scene = game.sceneManager.scene;\r\n    this.track = game.trackManager.mesh;\r\n    this.navTrackAgent = game.navTrackAgent;\r\n\r\n    var geometry = new THREE.BoxGeometry( 1, 3, 10 );\r\n    var material = new THREE.MeshBasicMaterial( {color: 0x0000ff} );\r\n\r\n    this.helperCameraMesh = new THREE.Mesh( geometry, material );\r\n    this.helperCameraMesh.add( new THREE.AxisHelper( 10 ) );\r\n    this.position = this.helperCameraMesh.position;\r\n\r\n    material = new THREE.MeshBasicMaterial( {color: 0xff0000} );\r\n    geometry = new THREE.BoxGeometry( 3, 3, 3 );\r\n\r\n    this.helperTargetMesh = new THREE.Mesh( geometry, material );\r\n    this.helperTargetMesh.add( new THREE.AxisHelper( 10 ) );\r\n    this.targetPosition = this.helperTargetMesh.position;\r\n\r\n    this.scene.add( this.helperCameraMesh );\r\n    this.scene.add( this.helperTargetMesh );\r\n\r\n    this.navTrackAgent.addEventListener(\r\n      'change',\r\n      this.updatePosition.bind( this )\r\n    );\r\n\r\n  }\r\n\r\n  updatePosition() {\r\n\r\n    var scope = this;\r\n    var amountTraveled = this.navTrackAgent.amountTraveled;\r\n    var pos = this.track.geometry.getPointAt( amountTraveled );\r\n    var normal = this.track.geometry.getNormalAt( amountTraveled );\r\n    var forward = this.track.geometry.getTangent( amountTraveled );\r\n    var next = this.navTrackAgent.nextAmountTraveled( 75 );\r\n    var lookAtPos = this.track.geometry.getPointAt( next );\r\n\r\n    updateCameraPos();\r\n    updateCameraRotation();\r\n\r\n    function updateCameraPos() {\r\n\r\n      var cameraPosition = new THREE.Vector3().copy( pos )\r\n      .addScaledVector( forward, scope.margin.back )\r\n      .addScaledVector( normal, scope.margin.top );\r\n\r\n      scope.position.copy( cameraPosition );\r\n\r\n    }\r\n\r\n    function updateCameraRotation() {\r\n\r\n      scope.helperCameraMesh.lookAt( lookAtPos );\r\n\r\n    }\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = PlayerCamera;\r\n","class SceneManager {\r\n\r\n  constructor(){\r\n\r\n    this.createScene();\r\n    // this.addHelpers();\r\n    this.addLights();\r\n\r\n  }\r\n\r\n  createScene() {\r\n\r\n    this.scene = new THREE.Scene();\r\n\r\n  }\r\n\r\n  addHelpers() {\r\n\r\n    this.scene.add( new THREE.AxisHelper( 20 ) );\r\n\r\n  }\r\n\r\n  addLights() {\r\n\r\n    var light = new THREE.SpotLight( 0xffffff, 1.5 );\r\n    light.position.set( 0, 1500, 200 );\r\n    light.castShadow = true;\r\n    light.shadow = new THREE.LightShadow( new THREE.PerspectiveCamera( 70, 1, 200, 2000 ) );\r\n    light.shadow.bias = -0.000222;\r\n    light.shadow.mapSize.width = 1024;\r\n    light.shadow.mapSize.height = 1024;\r\n\r\n    this.scene.add( light );\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = SceneManager;\r\n","class LinearTranstition {\r\n\r\n  constructor( points ) {\r\n\r\n    this.points = points;\r\n\r\n  }\r\n\r\n  getPointAt ( at ) {\r\n\r\n    let maxIndex = this.points.length - 1;\r\n\r\n    let i = parseInt( at * maxIndex );\r\n\r\n    let i2 = ( i < maxIndex - 1 ) ? i + 1 : i;\r\n\r\n    let rest = ( at * maxIndex ) % 1;\r\n\r\n    let point1 = new THREE.Vector3()\r\n    .copy( this.points[ i ] )\r\n    .multiplyScalar( 1 - rest );\r\n\r\n    let point2 = new THREE.Vector3()\r\n    .copy( this.points[ i2 ] )\r\n    .multiplyScalar( rest );\r\n\r\n    let pointAt = new THREE.Vector3()\r\n    .addVectors( point1, point2 )\r\n    .normalize();\r\n\r\n    return pointAt;\r\n\r\n  }\r\n\r\n}\r\n\r\nclass TrackGeometry extends THREE.BufferGeometry {\r\n\r\n  constructor( ctrlPoints, ctrlNormals, width, segments ) {\r\n\r\n    super();\r\n\r\n    this.type = 'TrackGeometry';\r\n    this.ctrlPoints = ctrlPoints;\r\n    this.ctrlNormals = ctrlNormals;\r\n    this.width = width;\r\n    this.segments = segments;\r\n\r\n    this.getPointAt = getPointAt;\r\n    this.getNormalAt = getNormalAt;\r\n    this.updateControlPoints = updateControlPoints;\r\n    this.generateVertices = generateVertices;\r\n    this.getLength = getLength;\r\n    this.getTangent = getTangent;\r\n\r\n    let\r\n    centerSpline = new THREE.CatmullRomCurve3( ctrlPoints ),\r\n    normalSpline = new LinearTranstition( ctrlNormals ),\r\n    scope = this;\r\n\r\n    normalSpline.tension = 0;\r\n\r\n    generateVertices();\r\n\r\n    function generateVertices() {\r\n\r\n      // buffers\r\n\r\n      let\r\n      indices = [],\r\n      vertices = [],\r\n      normals = [],\r\n      uvs = [];\r\n\r\n      // Generate vertices\r\n\r\n      let\r\n      centerLine = centerSpline.getPoints( scope.segments ),\r\n      leftV = [],\r\n      rightV = [],\r\n      normals2 = [];\r\n\r\n      for ( let i = 0; i < scope.segments + 1; i ++ ) {\r\n\r\n        let forward = centerSpline.getTangent( i / scope.segments );\r\n        let up = normalSpline.getPointAt( i / scope.segments );\r\n\r\n        let right = new THREE.Vector3()\r\n        .crossVectors( forward, up )\r\n        .normalize()\r\n        .multiplyScalar( scope.width * 0.5 );\r\n\r\n        let rightPoint = new THREE.Vector3()\r\n        .addVectors( centerLine[ i ], right );\r\n\r\n        let leftPoint = new THREE.Vector3()\r\n        .subVectors( centerLine[ i ], right );\r\n\r\n        leftV.push( leftPoint.toArray() );\r\n\r\n        rightV.push( rightPoint.toArray() );\r\n\r\n        let normal = new THREE.Vector3().crossVectors( right, forward ).normalize();\r\n\r\n        normals.push( normal.toArray() );\r\n\r\n      }\r\n\r\n      let totalDistance = 0;\r\n\r\n\r\n      for ( let i = 0; i < scope.segments; i ++ ) {\r\n\r\n        vertices.push( ...leftV[ i ], ...rightV[ i ], ...leftV[ i + 1 ] );\r\n        vertices.push( ...leftV[ i + 1 ], ...rightV[ i ], ...rightV[ i + 1 ] );\r\n\r\n        normals2.push( ...normals[ i ], ...normals[ i ], ...normals[ i + 1 ] );\r\n        normals2.push( ...normals[ i + 1 ], ...normals[ i ], ...normals[ i + 1 ] );\r\n\r\n        let distance = centerLine[ i ].distanceTo( centerLine[ i + 1 ] ) / scope.width;\r\n        totalDistance += distance;\r\n        uvs.push(\r\n          0, 0,\r\n          1, 0,\r\n          0, totalDistance\r\n        );\r\n        uvs.push(\r\n          0, totalDistance,\r\n          1, 0,\r\n          1, totalDistance\r\n        );\r\n\r\n      }\r\n\r\n      scope.addAttribute( 'position', new THREE.Float32BufferAttribute( vertices, 3 ) );\r\n\r\n      scope.addAttribute( 'normal', new THREE.Float32BufferAttribute( normals2, 3 ) );\r\n\r\n      scope.addAttribute( 'uv', new THREE.Float32BufferAttribute( uvs, 2 ) );\r\n\r\n    }\r\n\r\n    function getNormalAt( t ) {\r\n\r\n      return normalSpline.getPointAt( t );\r\n\r\n    }\r\n\r\n    function getPointAt( t ) {\r\n\r\n      return centerSpline.getPointAt( t );\r\n\r\n    }\r\n\r\n    function getLength() {\r\n\r\n      return centerSpline.getLength();\r\n\r\n    }\r\n\r\n    function getTangent( t ) {\r\n\r\n      return centerSpline.getTangent( t );\r\n\r\n    }\r\n\r\n    function updateControlPoints( ctrlPoints, normalPoints ) {\r\n\r\n      centerSpline = new THREE.CatmullRomCurve3( ctrlPoints );\r\n      if ( typeof normalPoints != 'undefined' ) {\r\n\r\n        normalSpline = new LinearTranstition( normalPoints );\r\n        normalSpline.tension = 0;\r\n\r\n      }\r\n      generateVertices();\r\n\r\n    }\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = TrackGeometry;\r\n","const TrackGeometry = require( './TrackGeometry.js' );\r\n\r\nclass TrackManager extends THREE.EventDispatcher {\r\n\r\n  constructor(){\r\n    super();\r\n    this._width = 0.01;\r\n    this.segments = 300;\r\n    this.editor = true;\r\n  }\r\n\r\n  get width(){\r\n    return this._width;\r\n  }\r\n\r\n  set width(value){\r\n    this._width = value;\r\n    this.updatePath();\r\n  }\r\n\r\n  requestTrackData() { return new Promise( ( resolve ) => {\r\n\r\n    $.getJSON( 'data/level01.json')\r\n    .done( (data ) =>{\r\n\r\n      this.onTrackDataResponse( data );\r\n      resolve();\r\n\r\n    } );\r\n\r\n  } ); }\r\n\r\n  onTrackDataResponse( data ) {\r\n\r\n    this.ctrlPoints = [];\r\n    this.ctrlNormals = [];\r\n\r\n    let i = 0;\r\n\r\n    for ( i = 0; i < data.ctrlPoints.length; i++ ) {\r\n\r\n      let pointArray = data.ctrlPoints[i];\r\n      let pointVector = new THREE.Vector3().fromArray( pointArray );\r\n      this.ctrlPoints.push( pointVector );\r\n\r\n    }\r\n\r\n    for ( i = 0; i < data.ctrlNormals.length; i++ ) {\r\n\r\n      let pointArray = data.ctrlNormals[i];\r\n      let pointVector = new THREE.Vector3().fromArray( pointArray );\r\n      this.ctrlNormals.push( pointVector );\r\n\r\n    }\r\n\r\n    this.createPath();\r\n\r\n  }\r\n\r\n  createPath() {\r\n\r\n    var pathGeometry = new TrackGeometry(\r\n      this.ctrlPoints,\r\n      this.ctrlNormals,\r\n      this._width,\r\n      this.segments\r\n    );\r\n    var material = new THREE.MeshNormalMaterial();\r\n    material.side = THREE.DoubleSide;\r\n    // material.wireframe = true;\r\n    this.mesh = new THREE.Mesh( pathGeometry, material );\r\n\r\n    if( this.editor ){\r\n      this.addEditor();\r\n    }\r\n\r\n  }\r\n\r\n  addEditor(){\r\n    this.gui = new dat.GUI();\r\n    this.gui.add(this, 'width', 0.000001, 0.5);\r\n    this.gui.add(this, 'startNewSpline');\r\n  }\r\n\r\n  startNewSpline(){\r\n    var meshCopy = this.mehs;\r\n    this.mesh = undefined;\r\n    this.gui.destroy();\r\n    this.dispatchEvent( { type: 'newSpline' } );\r\n  }\r\n\r\n  updatePath(){\r\n    this.mesh.geometry.dispose();\r\n\r\n    this.mesh.geometry = new TrackGeometry(\r\n      this.ctrlPoints,\r\n      this.ctrlNormals,\r\n      this._width,\r\n      this.segments\r\n    );\r\n  }\r\n\r\n  updateCtrlPoints(points){\r\n    this.ctrlPoints = [];\r\n    this.ctrlNormals = [];\r\n    for (var i = 0; i < points.length; i++) {\r\n      var point = points[i];\r\n      this.ctrlPoints.push(point.position);\r\n\r\n      var matrix = new THREE.Matrix4();\r\n      matrix.extractRotation( point.matrix );\n      var direction = new THREE.Vector3( 0, 1, 0 ).applyMatrix4(matrix);\r\n      this.ctrlNormals.push(direction);\r\n    }\r\n\r\n  }\r\n\r\n  getLength() {\r\n\r\n    return this.mesh.geometry.getLength();\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = TrackManager;\r\n","let EventDispatcher = require( '../../vendor/EventDispatcher.js' );\r\n\r\nclass WindowManager extends EventDispatcher {\r\n\r\n  constructor() {\r\n\r\n    super();\r\n\r\n    this.createWindow();\r\n\r\n  }\r\n\r\n  createWindow() {\r\n\r\n    var dom = document.getElementById( 'container' );\r\n    this.renderer = new THREE.WebGLRenderer();\r\n    this.renderer.setClearColor( 0xf0f0f0 );\r\n    dom.appendChild( this.renderer.domElement );\r\n    this.resize();\r\n\r\n  }\r\n\r\n  resize() {\r\n\r\n    this.renderer.setSize( window.innerWidth, window.innerHeight );\r\n\r\n  }\r\n\r\n  render() {\r\n\r\n    this.dispatchEvent( { type: 'onPreRender' } );\r\n    this.renderer.render( this.scene, this.camera );\r\n    window.requestAnimationFrame( this.render.bind( this ) );\r\n\r\n  }\r\n\r\n}\r\n\r\nmodule.exports = WindowManager;\r\n","let\r\nGame = require( './game/Game.js' );\r\n\r\n(function () {\r\n\r\n  'use strict';\r\n\r\n  var game = new Game();\r\n\r\n})();\r\n","/**\r\n * @author mrdoob / http://mrdoob.com/\r\n */\r\n\r\nfunction EventDispatcher() {}\r\n\r\nObject.assign( EventDispatcher.prototype, {\r\n\r\n\taddEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) this._listeners = {};\r\n\r\n\t\tvar listeners = this._listeners;\r\n\r\n\t\tif ( listeners[ type ] === undefined ) {\r\n\r\n\t\t\tlisteners[ type ] = [];\r\n\r\n\t\t}\r\n\r\n\t\tif ( listeners[ type ].indexOf( listener ) === - 1 ) {\r\n\r\n\t\t\tlisteners[ type ].push( listener );\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\thasEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return false;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\r\n\t\treturn listeners[ type ] !== undefined && listeners[ type ].indexOf( listener ) !== - 1;\r\n\r\n\t},\r\n\r\n\tremoveEventListener: function ( type, listener ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tvar index = listenerArray.indexOf( listener );\r\n\r\n\t\t\tif ( index !== - 1 ) {\r\n\r\n\t\t\t\tlistenerArray.splice( index, 1 );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t},\r\n\r\n\tdispatchEvent: function ( event ) {\r\n\r\n\t\tif ( this._listeners === undefined ) return;\r\n\r\n\t\tvar listeners = this._listeners;\r\n\t\tvar listenerArray = listeners[ event.type ];\r\n\r\n\t\tif ( listenerArray !== undefined ) {\r\n\r\n\t\t\tevent.target = this;\r\n\r\n\t\t\tvar array = listenerArray.slice( 0 );\r\n\r\n\t\t\tfor ( var i = 0, l = array.length; i < l; i ++ ) {\r\n\r\n\t\t\t\tarray[ i ].call( this, event );\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n} );\r\n\r\nmodule.exports = EventDispatcher;\r\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJqcy9jb250cm9scy9PcmJpdENvbnRyb2xzLmpzIiwianMvZ2FtZS9DYW1lcmFNYW5hZ2VyLmpzIiwianMvZ2FtZS9HYW1lLmpzIiwianMvZ2FtZS9OYXZUcmFja0FnZW50LmpzIiwianMvZ2FtZS9QbGF5ZXIuanMiLCJqcy9nYW1lL1BsYXllckNhbWVyYS5qcyIsImpzL2dhbWUvU2NlbmVNYW5hZ2VyLmpzIiwianMvZ2FtZS9UcmFja0dlb21ldHJ5LmpzIiwianMvZ2FtZS9UcmFja01hbmFnZXIuanMiLCJqcy9nYW1lL1dpbmRvd01hbmFnZXIuanMiLCJqcy9zY3JpcHQuanMiLCJ2ZW5kb3IvRXZlbnREaXNwYXRjaGVyLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMxL0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDekJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUN4TEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUhBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3ZDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLyoqXHJcbiAqIEBhdXRob3IgcWlhbyAvIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvXHJcbiAqIEBhdXRob3IgbXJkb29iIC8gaHR0cDovL21yZG9vYi5jb21cclxuICogQGF1dGhvciBhbHRlcmVkcSAvIGh0dHA6Ly9hbHRlcmVkcXVhbGlhLmNvbS9cclxuICogQGF1dGhvciBXZXN0TGFuZ2xleSAvIGh0dHA6Ly9naXRodWIuY29tL1dlc3RMYW5nbGV5XHJcbiAqIEBhdXRob3IgZXJpY2g2NjYgLyBodHRwOi8vZXJpY2hhaW5lcy5jb21cclxuKi9cclxuXHJcbi8vIFRoaXMgc2V0IG9mIGNvbnRyb2xzIHBlcmZvcm1zIG9yYml0aW5nLCBkb2xseWluZyAoem9vbWluZyksIGFuZCBwYW5uaW5nLlxyXG4vLyBVbmxpa2UgVHJhY2tiYWxsQ29udHJvbHMsIGl0IG1haW50YWlucyB0aGUgXCJ1cFwiIGRpcmVjdGlvbiBvYmplY3QudXAgKCtZIGJ5IGRlZmF1bHQpLlxyXG4vL1xyXG4vLyAgICBPcmJpdCAtIGxlZnQgbW91c2UgLyB0b3VjaDogb25lIGZpbmdlciBtb3ZlXHJcbi8vICAgIFpvb20gLSBtaWRkbGUgbW91c2UsIG9yIG1vdXNld2hlZWwgLyB0b3VjaDogdHdvIGZpbmdlciBzcHJlYWQgb3Igc3F1aXNoXHJcbi8vICAgIFBhbiAtIHJpZ2h0IG1vdXNlLCBvciBhcnJvdyBrZXlzIC8gdG91Y2g6IHRocmVlIGZpbnRlciBzd2lwZVxyXG5cclxuZnVuY3Rpb24gT3JiaXRDb250cm9scyggb2JqZWN0LCBkb21FbGVtZW50ICkge1xyXG5cclxuXHR0aGlzLm9iamVjdCA9IG9iamVjdDtcclxuXHJcblx0dGhpcy5kb21FbGVtZW50ID0gKCBkb21FbGVtZW50ICE9PSB1bmRlZmluZWQgKSA/IGRvbUVsZW1lbnQgOiBkb2N1bWVudDtcclxuXHJcblx0Ly8gU2V0IHRvIGZhbHNlIHRvIGRpc2FibGUgdGhpcyBjb250cm9sXHJcblx0dGhpcy5lbmFibGVkID0gdHJ1ZTtcclxuXHJcblx0Ly8gXCJ0YXJnZXRcIiBzZXRzIHRoZSBsb2NhdGlvbiBvZiBmb2N1cywgd2hlcmUgdGhlIG9iamVjdCBvcmJpdHMgYXJvdW5kXHJcblx0dGhpcy50YXJnZXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cclxuXHQvLyBIb3cgZmFyIHlvdSBjYW4gZG9sbHkgaW4gYW5kIG91dCAoIFBlcnNwZWN0aXZlQ2FtZXJhIG9ubHkgKVxyXG5cdHRoaXMubWluRGlzdGFuY2UgPSAwO1xyXG5cdHRoaXMubWF4RGlzdGFuY2UgPSBJbmZpbml0eTtcclxuXHJcblx0Ly8gSG93IGZhciB5b3UgY2FuIHpvb20gaW4gYW5kIG91dCAoIE9ydGhvZ3JhcGhpY0NhbWVyYSBvbmx5IClcclxuXHR0aGlzLm1pblpvb20gPSAwO1xyXG5cdHRoaXMubWF4Wm9vbSA9IEluZmluaXR5O1xyXG5cclxuXHQvLyBIb3cgZmFyIHlvdSBjYW4gb3JiaXQgdmVydGljYWxseSwgdXBwZXIgYW5kIGxvd2VyIGxpbWl0cy5cclxuXHQvLyBSYW5nZSBpcyAwIHRvIE1hdGguUEkgcmFkaWFucy5cclxuXHR0aGlzLm1pblBvbGFyQW5nbGUgPSAwOyAvLyByYWRpYW5zXHJcblx0dGhpcy5tYXhQb2xhckFuZ2xlID0gTWF0aC5QSTsgLy8gcmFkaWFuc1xyXG5cclxuXHQvLyBIb3cgZmFyIHlvdSBjYW4gb3JiaXQgaG9yaXpvbnRhbGx5LCB1cHBlciBhbmQgbG93ZXIgbGltaXRzLlxyXG5cdC8vIElmIHNldCwgbXVzdCBiZSBhIHN1Yi1pbnRlcnZhbCBvZiB0aGUgaW50ZXJ2YWwgWyAtIE1hdGguUEksIE1hdGguUEkgXS5cclxuXHR0aGlzLm1pbkF6aW11dGhBbmdsZSA9IC0gSW5maW5pdHk7IC8vIHJhZGlhbnNcclxuXHR0aGlzLm1heEF6aW11dGhBbmdsZSA9IEluZmluaXR5OyAvLyByYWRpYW5zXHJcblxyXG5cdC8vIFNldCB0byB0cnVlIHRvIGVuYWJsZSBkYW1waW5nIChpbmVydGlhKVxyXG5cdC8vIElmIGRhbXBpbmcgaXMgZW5hYmxlZCwgeW91IG11c3QgY2FsbCBjb250cm9scy51cGRhdGUoKSBpbiB5b3VyIGFuaW1hdGlvbiBsb29wXHJcblx0dGhpcy5lbmFibGVEYW1waW5nID0gZmFsc2U7XHJcblx0dGhpcy5kYW1waW5nRmFjdG9yID0gMC4yNTtcclxuXHJcblx0Ly8gVGhpcyBvcHRpb24gYWN0dWFsbHkgZW5hYmxlcyBkb2xseWluZyBpbiBhbmQgb3V0OyBsZWZ0IGFzIFwiem9vbVwiIGZvciBiYWNrd2FyZHMgY29tcGF0aWJpbGl0eS5cclxuXHQvLyBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSB6b29taW5nXHJcblx0dGhpcy5lbmFibGVab29tID0gdHJ1ZTtcclxuXHR0aGlzLnpvb21TcGVlZCA9IDEuMDtcclxuXHJcblx0Ly8gU2V0IHRvIGZhbHNlIHRvIGRpc2FibGUgcm90YXRpbmdcclxuXHR0aGlzLmVuYWJsZVJvdGF0ZSA9IHRydWU7XHJcblx0dGhpcy5yb3RhdGVTcGVlZCA9IDEuMDtcclxuXHJcblx0Ly8gU2V0IHRvIGZhbHNlIHRvIGRpc2FibGUgcGFubmluZ1xyXG5cdHRoaXMuZW5hYmxlUGFuID0gdHJ1ZTtcclxuXHR0aGlzLmtleVBhblNwZWVkID0gNy4wO1x0Ly8gcGl4ZWxzIG1vdmVkIHBlciBhcnJvdyBrZXkgcHVzaFxyXG5cclxuXHQvLyBTZXQgdG8gdHJ1ZSB0byBhdXRvbWF0aWNhbGx5IHJvdGF0ZSBhcm91bmQgdGhlIHRhcmdldFxyXG5cdC8vIElmIGF1dG8tcm90YXRlIGlzIGVuYWJsZWQsIHlvdSBtdXN0IGNhbGwgY29udHJvbHMudXBkYXRlKCkgaW4geW91ciBhbmltYXRpb24gbG9vcFxyXG5cdHRoaXMuYXV0b1JvdGF0ZSA9IGZhbHNlO1xyXG5cdHRoaXMuYXV0b1JvdGF0ZVNwZWVkID0gMi4wOyAvLyAzMCBzZWNvbmRzIHBlciByb3VuZCB3aGVuIGZwcyBpcyA2MFxyXG5cclxuXHQvLyBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSB1c2Ugb2YgdGhlIGtleXNcclxuXHR0aGlzLmVuYWJsZUtleXMgPSB0cnVlO1xyXG5cclxuXHQvLyBUaGUgZm91ciBhcnJvdyBrZXlzXHJcblx0dGhpcy5rZXlzID0geyBMRUZUOiAzNywgVVA6IDM4LCBSSUdIVDogMzksIEJPVFRPTTogNDAgfTtcclxuXHJcblx0Ly8gTW91c2UgYnV0dG9uc1xyXG5cdHRoaXMubW91c2VCdXR0b25zID0geyBPUkJJVDogVEhSRUUuTU9VU0UuTEVGVCwgWk9PTTogVEhSRUUuTU9VU0UuTUlERExFLCBQQU46IFRIUkVFLk1PVVNFLlJJR0hUIH07XHJcblxyXG5cdC8vIGZvciByZXNldFxyXG5cdHRoaXMudGFyZ2V0MCA9IHRoaXMudGFyZ2V0LmNsb25lKCk7XHJcblx0dGhpcy5wb3NpdGlvbjAgPSB0aGlzLm9iamVjdC5wb3NpdGlvbi5jbG9uZSgpO1xyXG5cdHRoaXMuem9vbTAgPSB0aGlzLm9iamVjdC56b29tO1xyXG5cclxuXHQvL1xyXG5cdC8vIHB1YmxpYyBtZXRob2RzXHJcblx0Ly9cclxuXHJcblx0dGhpcy5nZXRQb2xhckFuZ2xlID0gZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdHJldHVybiBzcGhlcmljYWwucGhpO1xyXG5cclxuXHR9O1xyXG5cclxuXHR0aGlzLmdldEF6aW11dGhhbEFuZ2xlID0gZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdHJldHVybiBzcGhlcmljYWwudGhldGE7XHJcblxyXG5cdH07XHJcblxyXG5cdHRoaXMucmVzZXQgPSBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0c2NvcGUudGFyZ2V0LmNvcHkoIHNjb3BlLnRhcmdldDAgKTtcclxuXHRcdHNjb3BlLm9iamVjdC5wb3NpdGlvbi5jb3B5KCBzY29wZS5wb3NpdGlvbjAgKTtcclxuXHRcdHNjb3BlLm9iamVjdC56b29tID0gc2NvcGUuem9vbTA7XHJcblxyXG5cdFx0c2NvcGUub2JqZWN0LnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHRcdHNjb3BlLmRpc3BhdGNoRXZlbnQoIGNoYW5nZUV2ZW50ICk7XHJcblxyXG5cdFx0c2NvcGUudXBkYXRlKCk7XHJcblxyXG5cdFx0c3RhdGUgPSBTVEFURS5OT05FO1xyXG5cclxuXHR9O1xyXG5cclxuXHQvLyB0aGlzIG1ldGhvZCBpcyBleHBvc2VkLCBidXQgcGVyaGFwcyBpdCB3b3VsZCBiZSBiZXR0ZXIgaWYgd2UgY2FuIG1ha2UgaXQgcHJpdmF0ZS4uLlxyXG5cdHRoaXMudXBkYXRlID0gZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0dmFyIG9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0Ly8gc28gY2FtZXJhLnVwIGlzIHRoZSBvcmJpdCBheGlzXHJcblx0XHR2YXIgcXVhdCA9IG5ldyBUSFJFRS5RdWF0ZXJuaW9uKCkuc2V0RnJvbVVuaXRWZWN0b3JzKCBvYmplY3QudXAsIG5ldyBUSFJFRS5WZWN0b3IzKCAwLCAxLCAwICkgKTtcclxuXHRcdHZhciBxdWF0SW52ZXJzZSA9IHF1YXQuY2xvbmUoKS5pbnZlcnNlKCk7XHJcblxyXG5cdFx0dmFyIGxhc3RQb3NpdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblx0XHR2YXIgbGFzdFF1YXRlcm5pb24gPSBuZXcgVEhSRUUuUXVhdGVybmlvbigpO1xyXG5cclxuXHRcdHJldHVybiBmdW5jdGlvbiB1cGRhdGUgKCkge1xyXG5cclxuXHRcdFx0dmFyIHBvc2l0aW9uID0gc2NvcGUub2JqZWN0LnBvc2l0aW9uO1xyXG5cclxuXHRcdFx0b2Zmc2V0LmNvcHkoIHBvc2l0aW9uICkuc3ViKCBzY29wZS50YXJnZXQgKTtcclxuXHJcblx0XHRcdC8vIHJvdGF0ZSBvZmZzZXQgdG8gXCJ5LWF4aXMtaXMtdXBcIiBzcGFjZVxyXG5cdFx0XHRvZmZzZXQuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0ICk7XHJcblxyXG5cdFx0XHQvLyBhbmdsZSBmcm9tIHotYXhpcyBhcm91bmQgeS1heGlzXHJcblx0XHRcdHNwaGVyaWNhbC5zZXRGcm9tVmVjdG9yMyggb2Zmc2V0ICk7XHJcblxyXG5cdFx0XHRpZiAoIHNjb3BlLmF1dG9Sb3RhdGUgJiYgc3RhdGUgPT09IFNUQVRFLk5PTkUgKSB7XHJcblxyXG5cdFx0XHRcdHJvdGF0ZUxlZnQoIGdldEF1dG9Sb3RhdGlvbkFuZ2xlKCkgKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHNwaGVyaWNhbC50aGV0YSArPSBzcGhlcmljYWxEZWx0YS50aGV0YTtcclxuXHRcdFx0c3BoZXJpY2FsLnBoaSArPSBzcGhlcmljYWxEZWx0YS5waGk7XHJcblxyXG5cdFx0XHQvLyByZXN0cmljdCB0aGV0YSB0byBiZSBiZXR3ZWVuIGRlc2lyZWQgbGltaXRzXHJcblx0XHRcdHNwaGVyaWNhbC50aGV0YSA9IE1hdGgubWF4KCBzY29wZS5taW5BemltdXRoQW5nbGUsIE1hdGgubWluKCBzY29wZS5tYXhBemltdXRoQW5nbGUsIHNwaGVyaWNhbC50aGV0YSApICk7XHJcblxyXG5cdFx0XHQvLyByZXN0cmljdCBwaGkgdG8gYmUgYmV0d2VlbiBkZXNpcmVkIGxpbWl0c1xyXG5cdFx0XHRzcGhlcmljYWwucGhpID0gTWF0aC5tYXgoIHNjb3BlLm1pblBvbGFyQW5nbGUsIE1hdGgubWluKCBzY29wZS5tYXhQb2xhckFuZ2xlLCBzcGhlcmljYWwucGhpICkgKTtcclxuXHJcblx0XHRcdHNwaGVyaWNhbC5tYWtlU2FmZSgpO1xyXG5cclxuXHJcblx0XHRcdHNwaGVyaWNhbC5yYWRpdXMgKj0gc2NhbGU7XHJcblxyXG5cdFx0XHQvLyByZXN0cmljdCByYWRpdXMgdG8gYmUgYmV0d2VlbiBkZXNpcmVkIGxpbWl0c1xyXG5cdFx0XHRzcGhlcmljYWwucmFkaXVzID0gTWF0aC5tYXgoIHNjb3BlLm1pbkRpc3RhbmNlLCBNYXRoLm1pbiggc2NvcGUubWF4RGlzdGFuY2UsIHNwaGVyaWNhbC5yYWRpdXMgKSApO1xyXG5cclxuXHRcdFx0Ly8gbW92ZSB0YXJnZXQgdG8gcGFubmVkIGxvY2F0aW9uXHJcblx0XHRcdHNjb3BlLnRhcmdldC5hZGQoIHBhbk9mZnNldCApO1xyXG5cclxuXHRcdFx0b2Zmc2V0LnNldEZyb21TcGhlcmljYWwoIHNwaGVyaWNhbCApO1xyXG5cclxuXHRcdFx0Ly8gcm90YXRlIG9mZnNldCBiYWNrIHRvIFwiY2FtZXJhLXVwLXZlY3Rvci1pcy11cFwiIHNwYWNlXHJcblx0XHRcdG9mZnNldC5hcHBseVF1YXRlcm5pb24oIHF1YXRJbnZlcnNlICk7XHJcblxyXG5cdFx0XHRwb3NpdGlvbi5jb3B5KCBzY29wZS50YXJnZXQgKS5hZGQoIG9mZnNldCApO1xyXG5cclxuXHRcdFx0c2NvcGUub2JqZWN0Lmxvb2tBdCggc2NvcGUudGFyZ2V0ICk7XHJcblxyXG5cdFx0XHRpZiAoIHNjb3BlLmVuYWJsZURhbXBpbmcgPT09IHRydWUgKSB7XHJcblxyXG5cdFx0XHRcdHNwaGVyaWNhbERlbHRhLnRoZXRhICo9ICggMSAtIHNjb3BlLmRhbXBpbmdGYWN0b3IgKTtcclxuXHRcdFx0XHRzcGhlcmljYWxEZWx0YS5waGkgKj0gKCAxIC0gc2NvcGUuZGFtcGluZ0ZhY3RvciApO1xyXG5cclxuXHRcdFx0fSBlbHNlIHtcclxuXHJcblx0XHRcdFx0c3BoZXJpY2FsRGVsdGEuc2V0KCAwLCAwLCAwICk7XHJcblxyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRzY2FsZSA9IDE7XHJcblx0XHRcdHBhbk9mZnNldC5zZXQoIDAsIDAsIDAgKTtcclxuXHJcblx0XHRcdC8vIHVwZGF0ZSBjb25kaXRpb24gaXM6XHJcblx0XHRcdC8vIG1pbihjYW1lcmEgZGlzcGxhY2VtZW50LCBjYW1lcmEgcm90YXRpb24gaW4gcmFkaWFucyleMiA+IEVQU1xyXG5cdFx0XHQvLyB1c2luZyBzbWFsbC1hbmdsZSBhcHByb3hpbWF0aW9uIGNvcyh4LzIpID0gMSAtIHheMiAvIDhcclxuXHJcblx0XHRcdGlmICggem9vbUNoYW5nZWQgfHxcclxuXHRcdFx0XHRsYXN0UG9zaXRpb24uZGlzdGFuY2VUb1NxdWFyZWQoIHNjb3BlLm9iamVjdC5wb3NpdGlvbiApID4gRVBTIHx8XHJcblx0XHRcdFx0OCAqICggMSAtIGxhc3RRdWF0ZXJuaW9uLmRvdCggc2NvcGUub2JqZWN0LnF1YXRlcm5pb24gKSApID4gRVBTICkge1xyXG5cclxuXHRcdFx0XHRzY29wZS5kaXNwYXRjaEV2ZW50KCBjaGFuZ2VFdmVudCApO1xyXG5cclxuXHRcdFx0XHRsYXN0UG9zaXRpb24uY29weSggc2NvcGUub2JqZWN0LnBvc2l0aW9uICk7XHJcblx0XHRcdFx0bGFzdFF1YXRlcm5pb24uY29weSggc2NvcGUub2JqZWN0LnF1YXRlcm5pb24gKTtcclxuXHRcdFx0XHR6b29tQ2hhbmdlZCA9IGZhbHNlO1xyXG5cclxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHJcblx0XHR9O1xyXG5cclxuXHR9KCk7XHJcblxyXG5cdHRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uKCkge1xyXG5cclxuXHRcdHNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2NvbnRleHRtZW51Jywgb25Db250ZXh0TWVudSwgZmFsc2UgKTtcclxuXHRcdHNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ21vdXNlZG93bicsIG9uTW91c2VEb3duLCBmYWxzZSApO1xyXG5cdFx0c2NvcGUuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAnd2hlZWwnLCBvbk1vdXNlV2hlZWwsIGZhbHNlICk7XHJcblxyXG5cdFx0c2NvcGUuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAndG91Y2hzdGFydCcsIG9uVG91Y2hTdGFydCwgZmFsc2UgKTtcclxuXHRcdHNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3RvdWNoZW5kJywgb25Ub3VjaEVuZCwgZmFsc2UgKTtcclxuXHRcdHNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3RvdWNobW92ZScsIG9uVG91Y2hNb3ZlLCBmYWxzZSApO1xyXG5cclxuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSwgZmFsc2UgKTtcclxuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZXVwJywgb25Nb3VzZVVwLCBmYWxzZSApO1xyXG5cclxuXHRcdHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIG9uS2V5RG93biwgZmFsc2UgKTtcclxuXHJcblx0XHQvL3Njb3BlLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsgLy8gc2hvdWxkIHRoaXMgYmUgYWRkZWQgaGVyZT9cclxuXHJcblx0fTtcclxuXHJcblx0Ly9cclxuXHQvLyBpbnRlcm5hbHNcclxuXHQvL1xyXG5cclxuXHR2YXIgc2NvcGUgPSB0aGlzO1xyXG5cclxuXHR2YXIgY2hhbmdlRXZlbnQgPSB7IHR5cGU6ICdjaGFuZ2UnIH07XHJcblx0dmFyIHN0YXJ0RXZlbnQgPSB7IHR5cGU6ICdzdGFydCcgfTtcclxuXHR2YXIgZW5kRXZlbnQgPSB7IHR5cGU6ICdlbmQnIH07XHJcblxyXG5cdHZhciBTVEFURSA9IHsgTk9ORSA6IC0gMSwgUk9UQVRFIDogMCwgRE9MTFkgOiAxLCBQQU4gOiAyLCBUT1VDSF9ST1RBVEUgOiAzLCBUT1VDSF9ET0xMWSA6IDQsIFRPVUNIX1BBTiA6IDUgfTtcclxuXHJcblx0dmFyIHN0YXRlID0gU1RBVEUuTk9ORTtcclxuXHJcblx0dmFyIEVQUyA9IDAuMDAwMDAxO1xyXG5cclxuXHQvLyBjdXJyZW50IHBvc2l0aW9uIGluIHNwaGVyaWNhbCBjb29yZGluYXRlc1xyXG5cdHZhciBzcGhlcmljYWwgPSBuZXcgVEhSRUUuU3BoZXJpY2FsKCk7XHJcblx0dmFyIHNwaGVyaWNhbERlbHRhID0gbmV3IFRIUkVFLlNwaGVyaWNhbCgpO1xyXG5cclxuXHR2YXIgc2NhbGUgPSAxO1xyXG5cdHZhciBwYW5PZmZzZXQgPSBuZXcgVEhSRUUuVmVjdG9yMygpO1xyXG5cdHZhciB6b29tQ2hhbmdlZCA9IGZhbHNlO1xyXG5cclxuXHR2YXIgcm90YXRlU3RhcnQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdHZhciByb3RhdGVFbmQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdHZhciByb3RhdGVEZWx0YSA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblxyXG5cdHZhciBwYW5TdGFydCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0dmFyIHBhbkVuZCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0dmFyIHBhbkRlbHRhID0gbmV3IFRIUkVFLlZlY3RvcjIoKTtcclxuXHJcblx0dmFyIGRvbGx5U3RhcnQgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cdHZhciBkb2xseUVuZCA9IG5ldyBUSFJFRS5WZWN0b3IyKCk7XHJcblx0dmFyIGRvbGx5RGVsdGEgPSBuZXcgVEhSRUUuVmVjdG9yMigpO1xyXG5cclxuXHRmdW5jdGlvbiBnZXRBdXRvUm90YXRpb25BbmdsZSgpIHtcclxuXHJcblx0XHRyZXR1cm4gMiAqIE1hdGguUEkgLyA2MCAvIDYwICogc2NvcGUuYXV0b1JvdGF0ZVNwZWVkO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGdldFpvb21TY2FsZSgpIHtcclxuXHJcblx0XHRyZXR1cm4gTWF0aC5wb3coIDAuOTUsIHNjb3BlLnpvb21TcGVlZCApO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJvdGF0ZUxlZnQoIGFuZ2xlICkge1xyXG5cclxuXHRcdHNwaGVyaWNhbERlbHRhLnRoZXRhIC09IGFuZ2xlO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIHJvdGF0ZVVwKCBhbmdsZSApIHtcclxuXHJcblx0XHRzcGhlcmljYWxEZWx0YS5waGkgLT0gYW5nbGU7XHJcblxyXG5cdH1cclxuXHJcblx0dmFyIHBhbkxlZnQgPSBmdW5jdGlvbigpIHtcclxuXHJcblx0XHR2YXIgdiA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uIHBhbkxlZnQoIGRpc3RhbmNlLCBvYmplY3RNYXRyaXggKSB7XHJcblxyXG5cdFx0XHR2LnNldEZyb21NYXRyaXhDb2x1bW4oIG9iamVjdE1hdHJpeCwgMCApOyAvLyBnZXQgWCBjb2x1bW4gb2Ygb2JqZWN0TWF0cml4XHJcblx0XHRcdHYubXVsdGlwbHlTY2FsYXIoIC0gZGlzdGFuY2UgKTtcclxuXHJcblx0XHRcdHBhbk9mZnNldC5hZGQoIHYgKTtcclxuXHJcblx0XHR9O1xyXG5cclxuXHR9KCk7XHJcblxyXG5cdHZhciBwYW5VcCA9IGZ1bmN0aW9uKCkge1xyXG5cclxuXHRcdHZhciB2ID0gbmV3IFRIUkVFLlZlY3RvcjMoKTtcclxuXHJcblx0XHRyZXR1cm4gZnVuY3Rpb24gcGFuVXAoIGRpc3RhbmNlLCBvYmplY3RNYXRyaXggKSB7XHJcblxyXG5cdFx0XHR2LnNldEZyb21NYXRyaXhDb2x1bW4oIG9iamVjdE1hdHJpeCwgMSApOyAvLyBnZXQgWSBjb2x1bW4gb2Ygb2JqZWN0TWF0cml4XHJcblx0XHRcdHYubXVsdGlwbHlTY2FsYXIoIGRpc3RhbmNlICk7XHJcblxyXG5cdFx0XHRwYW5PZmZzZXQuYWRkKCB2ICk7XHJcblxyXG5cdFx0fTtcclxuXHJcblx0fSgpO1xyXG5cclxuXHQvLyBkZWx0YVggYW5kIGRlbHRhWSBhcmUgaW4gcGl4ZWxzOyByaWdodCBhbmQgZG93biBhcmUgcG9zaXRpdmVcclxuXHR2YXIgcGFuID0gZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0dmFyIG9mZnNldCA9IG5ldyBUSFJFRS5WZWN0b3IzKCk7XHJcblxyXG5cdFx0cmV0dXJuIGZ1bmN0aW9uIHBhbiAoIGRlbHRhWCwgZGVsdGFZICkge1xyXG5cclxuXHRcdFx0dmFyIGVsZW1lbnQgPSBzY29wZS5kb21FbGVtZW50ID09PSBkb2N1bWVudCA/IHNjb3BlLmRvbUVsZW1lbnQuYm9keSA6IHNjb3BlLmRvbUVsZW1lbnQ7XHJcblxyXG5cdFx0XHRpZiAoIHNjb3BlLm9iamVjdCBpbnN0YW5jZW9mIFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhICkge1xyXG5cclxuXHRcdFx0XHQvLyBwZXJzcGVjdGl2ZVxyXG5cdFx0XHRcdHZhciBwb3NpdGlvbiA9IHNjb3BlLm9iamVjdC5wb3NpdGlvbjtcclxuXHRcdFx0XHRvZmZzZXQuY29weSggcG9zaXRpb24gKS5zdWIoIHNjb3BlLnRhcmdldCApO1xyXG5cdFx0XHRcdHZhciB0YXJnZXREaXN0YW5jZSA9IG9mZnNldC5sZW5ndGgoKTtcclxuXHJcblx0XHRcdFx0Ly8gaGFsZiBvZiB0aGUgZm92IGlzIGNlbnRlciB0byB0b3Agb2Ygc2NyZWVuXHJcblx0XHRcdFx0dGFyZ2V0RGlzdGFuY2UgKj0gTWF0aC50YW4oICggc2NvcGUub2JqZWN0LmZvdiAvIDIgKSAqIE1hdGguUEkgLyAxODAuMCApO1xyXG5cclxuXHRcdFx0XHQvLyB3ZSBhY3R1YWxseSBkb24ndCB1c2Ugc2NyZWVuV2lkdGgsIHNpbmNlIHBlcnNwZWN0aXZlIGNhbWVyYSBpcyBmaXhlZCB0byBzY3JlZW4gaGVpZ2h0XHJcblx0XHRcdFx0cGFuTGVmdCggMiAqIGRlbHRhWCAqIHRhcmdldERpc3RhbmNlIC8gZWxlbWVudC5jbGllbnRIZWlnaHQsIHNjb3BlLm9iamVjdC5tYXRyaXggKTtcclxuXHRcdFx0XHRwYW5VcCggMiAqIGRlbHRhWSAqIHRhcmdldERpc3RhbmNlIC8gZWxlbWVudC5jbGllbnRIZWlnaHQsIHNjb3BlLm9iamVjdC5tYXRyaXggKTtcclxuXHJcblx0XHRcdH0gZWxzZSBpZiAoIHNjb3BlLm9iamVjdCBpbnN0YW5jZW9mIFRIUkVFLk9ydGhvZ3JhcGhpY0NhbWVyYSApIHtcclxuXHJcblx0XHRcdFx0Ly8gb3J0aG9ncmFwaGljXHJcblx0XHRcdFx0cGFuTGVmdCggZGVsdGFYICogKCBzY29wZS5vYmplY3QucmlnaHQgLSBzY29wZS5vYmplY3QubGVmdCApIC8gc2NvcGUub2JqZWN0Lnpvb20gLyBlbGVtZW50LmNsaWVudFdpZHRoLCBzY29wZS5vYmplY3QubWF0cml4ICk7XHJcblx0XHRcdFx0cGFuVXAoIGRlbHRhWSAqICggc2NvcGUub2JqZWN0LnRvcCAtIHNjb3BlLm9iamVjdC5ib3R0b20gKSAvIHNjb3BlLm9iamVjdC56b29tIC8gZWxlbWVudC5jbGllbnRIZWlnaHQsIHNjb3BlLm9iamVjdC5tYXRyaXggKTtcclxuXHJcblx0XHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRcdC8vIGNhbWVyYSBuZWl0aGVyIG9ydGhvZ3JhcGhpYyBub3IgcGVyc3BlY3RpdmVcclxuXHRcdFx0XHRjb25zb2xlLndhcm4oICdXQVJOSU5HOiBPcmJpdENvbnRyb2xzLmpzIGVuY291bnRlcmVkIGFuIHVua25vd24gY2FtZXJhIHR5cGUgLSBwYW4gZGlzYWJsZWQuJyApO1xyXG5cdFx0XHRcdHNjb3BlLmVuYWJsZVBhbiA9IGZhbHNlO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdH07XHJcblxyXG5cdH0oKTtcclxuXHJcblx0ZnVuY3Rpb24gZG9sbHlJbiggZG9sbHlTY2FsZSApIHtcclxuXHJcblx0XHRpZiAoIHNjb3BlLm9iamVjdCBpbnN0YW5jZW9mIFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhICkge1xyXG5cclxuXHRcdFx0c2NhbGUgLz0gZG9sbHlTY2FsZTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKCBzY29wZS5vYmplY3QgaW5zdGFuY2VvZiBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEgKSB7XHJcblxyXG5cdFx0XHRzY29wZS5vYmplY3Quem9vbSA9IE1hdGgubWF4KCBzY29wZS5taW5ab29tLCBNYXRoLm1pbiggc2NvcGUubWF4Wm9vbSwgc2NvcGUub2JqZWN0Lnpvb20gKiBkb2xseVNjYWxlICkgKTtcclxuXHRcdFx0c2NvcGUub2JqZWN0LnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHRcdFx0em9vbUNoYW5nZWQgPSB0cnVlO1xyXG5cclxuXHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRjb25zb2xlLndhcm4oICdXQVJOSU5HOiBPcmJpdENvbnRyb2xzLmpzIGVuY291bnRlcmVkIGFuIHVua25vd24gY2FtZXJhIHR5cGUgLSBkb2xseS96b29tIGRpc2FibGVkLicgKTtcclxuXHRcdFx0c2NvcGUuZW5hYmxlWm9vbSA9IGZhbHNlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBkb2xseU91dCggZG9sbHlTY2FsZSApIHtcclxuXHJcblx0XHRpZiAoIHNjb3BlLm9iamVjdCBpbnN0YW5jZW9mIFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhICkge1xyXG5cclxuXHRcdFx0c2NhbGUgKj0gZG9sbHlTY2FsZTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKCBzY29wZS5vYmplY3QgaW5zdGFuY2VvZiBUSFJFRS5PcnRob2dyYXBoaWNDYW1lcmEgKSB7XHJcblxyXG5cdFx0XHRzY29wZS5vYmplY3Quem9vbSA9IE1hdGgubWF4KCBzY29wZS5taW5ab29tLCBNYXRoLm1pbiggc2NvcGUubWF4Wm9vbSwgc2NvcGUub2JqZWN0Lnpvb20gLyBkb2xseVNjYWxlICkgKTtcclxuXHRcdFx0c2NvcGUub2JqZWN0LnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcclxuXHRcdFx0em9vbUNoYW5nZWQgPSB0cnVlO1xyXG5cclxuXHRcdH0gZWxzZSB7XHJcblxyXG5cdFx0XHRjb25zb2xlLndhcm4oICdXQVJOSU5HOiBPcmJpdENvbnRyb2xzLmpzIGVuY291bnRlcmVkIGFuIHVua25vd24gY2FtZXJhIHR5cGUgLSBkb2xseS96b29tIGRpc2FibGVkLicgKTtcclxuXHRcdFx0c2NvcGUuZW5hYmxlWm9vbSA9IGZhbHNlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHQvL1xyXG5cdC8vIGV2ZW50IGNhbGxiYWNrcyAtIHVwZGF0ZSB0aGUgb2JqZWN0IHN0YXRlXHJcblx0Ly9cclxuXHJcblx0ZnVuY3Rpb24gaGFuZGxlTW91c2VEb3duUm90YXRlKCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlTW91c2VEb3duUm90YXRlJyApO1xyXG5cclxuXHRcdHJvdGF0ZVN0YXJ0LnNldCggZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSApO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGhhbmRsZU1vdXNlRG93bkRvbGx5KCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlTW91c2VEb3duRG9sbHknICk7XHJcblxyXG5cdFx0ZG9sbHlTdGFydC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVNb3VzZURvd25QYW4oIGV2ZW50ICkge1xyXG5cclxuXHRcdC8vY29uc29sZS5sb2coICdoYW5kbGVNb3VzZURvd25QYW4nICk7XHJcblxyXG5cdFx0cGFuU3RhcnQuc2V0KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlUm90YXRlKCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlTW91c2VNb3ZlUm90YXRlJyApO1xyXG5cclxuXHRcdHJvdGF0ZUVuZC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTtcclxuXHRcdHJvdGF0ZURlbHRhLnN1YlZlY3RvcnMoIHJvdGF0ZUVuZCwgcm90YXRlU3RhcnQgKTtcclxuXHJcblx0XHR2YXIgZWxlbWVudCA9IHNjb3BlLmRvbUVsZW1lbnQgPT09IGRvY3VtZW50ID8gc2NvcGUuZG9tRWxlbWVudC5ib2R5IDogc2NvcGUuZG9tRWxlbWVudDtcclxuXHJcblx0XHQvLyByb3RhdGluZyBhY3Jvc3Mgd2hvbGUgc2NyZWVuIGdvZXMgMzYwIGRlZ3JlZXMgYXJvdW5kXHJcblx0XHRyb3RhdGVMZWZ0KCAyICogTWF0aC5QSSAqIHJvdGF0ZURlbHRhLnggLyBlbGVtZW50LmNsaWVudFdpZHRoICogc2NvcGUucm90YXRlU3BlZWQgKTtcclxuXHJcblx0XHQvLyByb3RhdGluZyB1cCBhbmQgZG93biBhbG9uZyB3aG9sZSBzY3JlZW4gYXR0ZW1wdHMgdG8gZ28gMzYwLCBidXQgbGltaXRlZCB0byAxODBcclxuXHRcdHJvdGF0ZVVwKCAyICogTWF0aC5QSSAqIHJvdGF0ZURlbHRhLnkgLyBlbGVtZW50LmNsaWVudEhlaWdodCAqIHNjb3BlLnJvdGF0ZVNwZWVkICk7XHJcblxyXG5cdFx0cm90YXRlU3RhcnQuY29weSggcm90YXRlRW5kICk7XHJcblxyXG5cdFx0c2NvcGUudXBkYXRlKCk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlRG9sbHkoIGV2ZW50ICkge1xyXG5cclxuXHRcdC8vY29uc29sZS5sb2coICdoYW5kbGVNb3VzZU1vdmVEb2xseScgKTtcclxuXHJcblx0XHRkb2xseUVuZC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTtcclxuXHJcblx0XHRkb2xseURlbHRhLnN1YlZlY3RvcnMoIGRvbGx5RW5kLCBkb2xseVN0YXJ0ICk7XHJcblxyXG5cdFx0aWYgKCBkb2xseURlbHRhLnkgPiAwICkge1xyXG5cclxuXHRcdFx0ZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCkgKTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKCBkb2xseURlbHRhLnkgPCAwICkge1xyXG5cclxuXHRcdFx0ZG9sbHlPdXQoIGdldFpvb21TY2FsZSgpICk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHRcdGRvbGx5U3RhcnQuY29weSggZG9sbHlFbmQgKTtcclxuXHJcblx0XHRzY29wZS51cGRhdGUoKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmVQYW4oIGV2ZW50ICkge1xyXG5cclxuXHRcdC8vY29uc29sZS5sb2coICdoYW5kbGVNb3VzZU1vdmVQYW4nICk7XHJcblxyXG5cdFx0cGFuRW5kLnNldCggZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSApO1xyXG5cclxuXHRcdHBhbkRlbHRhLnN1YlZlY3RvcnMoIHBhbkVuZCwgcGFuU3RhcnQgKTtcclxuXHJcblx0XHRwYW4oIHBhbkRlbHRhLngsIHBhbkRlbHRhLnkgKTtcclxuXHJcblx0XHRwYW5TdGFydC5jb3B5KCBwYW5FbmQgKTtcclxuXHJcblx0XHRzY29wZS51cGRhdGUoKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVNb3VzZVVwKCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlTW91c2VVcCcgKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVNb3VzZVdoZWVsKCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlTW91c2VXaGVlbCcgKTtcclxuXHJcblx0XHRpZiAoIGV2ZW50LmRlbHRhWSA8IDAgKSB7XHJcblxyXG5cdFx0XHRkb2xseU91dCggZ2V0Wm9vbVNjYWxlKCkgKTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKCBldmVudC5kZWx0YVkgPiAwICkge1xyXG5cclxuXHRcdFx0ZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCkgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0c2NvcGUudXBkYXRlKCk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gaGFuZGxlS2V5RG93biggZXZlbnQgKSB7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ2hhbmRsZUtleURvd24nICk7XHJcblxyXG5cdFx0c3dpdGNoICggZXZlbnQua2V5Q29kZSApIHtcclxuXHJcblx0XHRcdGNhc2Ugc2NvcGUua2V5cy5VUDpcclxuXHRcdFx0XHRwYW4oIDAsIHNjb3BlLmtleVBhblNwZWVkICk7XHJcblx0XHRcdFx0c2NvcGUudXBkYXRlKCk7XHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIHNjb3BlLmtleXMuQk9UVE9NOlxyXG5cdFx0XHRcdHBhbiggMCwgLSBzY29wZS5rZXlQYW5TcGVlZCApO1xyXG5cdFx0XHRcdHNjb3BlLnVwZGF0ZSgpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBzY29wZS5rZXlzLkxFRlQ6XHJcblx0XHRcdFx0cGFuKCBzY29wZS5rZXlQYW5TcGVlZCwgMCApO1xyXG5cdFx0XHRcdHNjb3BlLnVwZGF0ZSgpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBzY29wZS5rZXlzLlJJR0hUOlxyXG5cdFx0XHRcdHBhbiggLSBzY29wZS5rZXlQYW5TcGVlZCwgMCApO1xyXG5cdFx0XHRcdHNjb3BlLnVwZGF0ZSgpO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0Um90YXRlKCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlVG91Y2hTdGFydFJvdGF0ZScgKTtcclxuXHJcblx0XHRyb3RhdGVTdGFydC5zZXQoIGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWCwgZXZlbnQudG91Y2hlc1sgMCBdLnBhZ2VZICk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydERvbGx5KCBldmVudCApIHtcclxuXHJcblx0XHQvL2NvbnNvbGUubG9nKCAnaGFuZGxlVG91Y2hTdGFydERvbGx5JyApO1xyXG5cclxuXHRcdHZhciBkeCA9IGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWCAtIGV2ZW50LnRvdWNoZXNbIDEgXS5wYWdlWDtcclxuXHRcdHZhciBkeSA9IGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWSAtIGV2ZW50LnRvdWNoZXNbIDEgXS5wYWdlWTtcclxuXHJcblx0XHR2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoIGR4ICogZHggKyBkeSAqIGR5ICk7XHJcblxyXG5cdFx0ZG9sbHlTdGFydC5zZXQoIDAsIGRpc3RhbmNlICk7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydFBhbiggZXZlbnQgKSB7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ2hhbmRsZVRvdWNoU3RhcnRQYW4nICk7XHJcblxyXG5cdFx0cGFuU3RhcnQuc2V0KCBldmVudC50b3VjaGVzWyAwIF0ucGFnZVgsIGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWSApO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZVJvdGF0ZSggZXZlbnQgKSB7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ2hhbmRsZVRvdWNoTW92ZVJvdGF0ZScgKTtcclxuXHJcblx0XHRyb3RhdGVFbmQuc2V0KCBldmVudC50b3VjaGVzWyAwIF0ucGFnZVgsIGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWSApO1xyXG5cdFx0cm90YXRlRGVsdGEuc3ViVmVjdG9ycyggcm90YXRlRW5kLCByb3RhdGVTdGFydCApO1xyXG5cclxuXHRcdHZhciBlbGVtZW50ID0gc2NvcGUuZG9tRWxlbWVudCA9PT0gZG9jdW1lbnQgPyBzY29wZS5kb21FbGVtZW50LmJvZHkgOiBzY29wZS5kb21FbGVtZW50O1xyXG5cclxuXHRcdC8vIHJvdGF0aW5nIGFjcm9zcyB3aG9sZSBzY3JlZW4gZ29lcyAzNjAgZGVncmVlcyBhcm91bmRcclxuXHRcdHJvdGF0ZUxlZnQoIDIgKiBNYXRoLlBJICogcm90YXRlRGVsdGEueCAvIGVsZW1lbnQuY2xpZW50V2lkdGggKiBzY29wZS5yb3RhdGVTcGVlZCApO1xyXG5cclxuXHRcdC8vIHJvdGF0aW5nIHVwIGFuZCBkb3duIGFsb25nIHdob2xlIHNjcmVlbiBhdHRlbXB0cyB0byBnbyAzNjAsIGJ1dCBsaW1pdGVkIHRvIDE4MFxyXG5cdFx0cm90YXRlVXAoIDIgKiBNYXRoLlBJICogcm90YXRlRGVsdGEueSAvIGVsZW1lbnQuY2xpZW50SGVpZ2h0ICogc2NvcGUucm90YXRlU3BlZWQgKTtcclxuXHJcblx0XHRyb3RhdGVTdGFydC5jb3B5KCByb3RhdGVFbmQgKTtcclxuXHJcblx0XHRzY29wZS51cGRhdGUoKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmVEb2xseSggZXZlbnQgKSB7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ2hhbmRsZVRvdWNoTW92ZURvbGx5JyApO1xyXG5cclxuXHRcdHZhciBkeCA9IGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWCAtIGV2ZW50LnRvdWNoZXNbIDEgXS5wYWdlWDtcclxuXHRcdHZhciBkeSA9IGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWSAtIGV2ZW50LnRvdWNoZXNbIDEgXS5wYWdlWTtcclxuXHJcblx0XHR2YXIgZGlzdGFuY2UgPSBNYXRoLnNxcnQoIGR4ICogZHggKyBkeSAqIGR5ICk7XHJcblxyXG5cdFx0ZG9sbHlFbmQuc2V0KCAwLCBkaXN0YW5jZSApO1xyXG5cclxuXHRcdGRvbGx5RGVsdGEuc3ViVmVjdG9ycyggZG9sbHlFbmQsIGRvbGx5U3RhcnQgKTtcclxuXHJcblx0XHRpZiAoIGRvbGx5RGVsdGEueSA+IDAgKSB7XHJcblxyXG5cdFx0XHRkb2xseU91dCggZ2V0Wm9vbVNjYWxlKCkgKTtcclxuXHJcblx0XHR9IGVsc2UgaWYgKCBkb2xseURlbHRhLnkgPCAwICkge1xyXG5cclxuXHRcdFx0ZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCkgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0ZG9sbHlTdGFydC5jb3B5KCBkb2xseUVuZCApO1xyXG5cclxuXHRcdHNjb3BlLnVwZGF0ZSgpO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZVBhbiggZXZlbnQgKSB7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ2hhbmRsZVRvdWNoTW92ZVBhbicgKTtcclxuXHJcblx0XHRwYW5FbmQuc2V0KCBldmVudC50b3VjaGVzWyAwIF0ucGFnZVgsIGV2ZW50LnRvdWNoZXNbIDAgXS5wYWdlWSApO1xyXG5cclxuXHRcdHBhbkRlbHRhLnN1YlZlY3RvcnMoIHBhbkVuZCwgcGFuU3RhcnQgKTtcclxuXHJcblx0XHRwYW4oIHBhbkRlbHRhLngsIHBhbkRlbHRhLnkgKTtcclxuXHJcblx0XHRwYW5TdGFydC5jb3B5KCBwYW5FbmQgKTtcclxuXHJcblx0XHRzY29wZS51cGRhdGUoKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBoYW5kbGVUb3VjaEVuZCggZXZlbnQgKSB7XHJcblxyXG5cdFx0Ly9jb25zb2xlLmxvZyggJ2hhbmRsZVRvdWNoRW5kJyApO1xyXG5cclxuXHR9XHJcblxyXG5cdC8vXHJcblx0Ly8gZXZlbnQgaGFuZGxlcnMgLSBGU006IGxpc3RlbiBmb3IgZXZlbnRzIGFuZCByZXNldCBzdGF0ZVxyXG5cdC8vXHJcblxyXG5cdGZ1bmN0aW9uIG9uTW91c2VEb3duKCBldmVudCApIHtcclxuXHJcblx0XHRpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuO1xyXG5cclxuXHRcdGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cdFx0aWYgKCBldmVudC5idXR0b24gPT09IHNjb3BlLm1vdXNlQnV0dG9ucy5PUkJJVCApIHtcclxuXHJcblx0XHRcdGlmICggc2NvcGUuZW5hYmxlUm90YXRlID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRcdGhhbmRsZU1vdXNlRG93blJvdGF0ZSggZXZlbnQgKTtcclxuXHJcblx0XHRcdHN0YXRlID0gU1RBVEUuUk9UQVRFO1xyXG5cclxuXHRcdH0gZWxzZSBpZiAoIGV2ZW50LmJ1dHRvbiA9PT0gc2NvcGUubW91c2VCdXR0b25zLlpPT00gKSB7XHJcblxyXG5cdFx0XHRpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICkgcmV0dXJuO1xyXG5cclxuXHRcdFx0aGFuZGxlTW91c2VEb3duRG9sbHkoIGV2ZW50ICk7XHJcblxyXG5cdFx0XHRzdGF0ZSA9IFNUQVRFLkRPTExZO1xyXG5cclxuXHRcdH0gZWxzZSBpZiAoIGV2ZW50LmJ1dHRvbiA9PT0gc2NvcGUubW91c2VCdXR0b25zLlBBTiApIHtcclxuXHJcblx0XHRcdGlmICggc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRcdGhhbmRsZU1vdXNlRG93blBhbiggZXZlbnQgKTtcclxuXHJcblx0XHRcdHN0YXRlID0gU1RBVEUuUEFOO1xyXG5cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIHN0YXRlICE9PSBTVEFURS5OT05FICkge1xyXG5cclxuXHRcdFx0ZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlbW92ZScsIG9uTW91c2VNb3ZlLCBmYWxzZSApO1xyXG5cdFx0XHRkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCAnbW91c2V1cCcsIG9uTW91c2VVcCwgZmFsc2UgKTtcclxuXHJcblx0XHRcdHNjb3BlLmRpc3BhdGNoRXZlbnQoIHN0YXJ0RXZlbnQgKTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gb25Nb3VzZU1vdmUoIGV2ZW50ICkge1xyXG5cclxuXHRcdGlmICggc2NvcGUuZW5hYmxlZCA9PT0gZmFsc2UgKSByZXR1cm47XHJcblxyXG5cdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0XHRpZiAoIHN0YXRlID09PSBTVEFURS5ST1RBVEUgKSB7XHJcblxyXG5cdFx0XHRpZiAoIHNjb3BlLmVuYWJsZVJvdGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47XHJcblxyXG5cdFx0XHRoYW5kbGVNb3VzZU1vdmVSb3RhdGUoIGV2ZW50ICk7XHJcblxyXG5cdFx0fSBlbHNlIGlmICggc3RhdGUgPT09IFNUQVRFLkRPTExZICkge1xyXG5cclxuXHRcdFx0aWYgKCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRcdGhhbmRsZU1vdXNlTW92ZURvbGx5KCBldmVudCApO1xyXG5cclxuXHRcdH0gZWxzZSBpZiAoIHN0YXRlID09PSBTVEFURS5QQU4gKSB7XHJcblxyXG5cdFx0XHRpZiAoIHNjb3BlLmVuYWJsZVBhbiA9PT0gZmFsc2UgKSByZXR1cm47XHJcblxyXG5cdFx0XHRoYW5kbGVNb3VzZU1vdmVQYW4oIGV2ZW50ICk7XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uTW91c2VVcCggZXZlbnQgKSB7XHJcblxyXG5cdFx0aWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRoYW5kbGVNb3VzZVVwKCBldmVudCApO1xyXG5cclxuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZW1vdmUnLCBvbk1vdXNlTW92ZSwgZmFsc2UgKTtcclxuXHRcdGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdtb3VzZXVwJywgb25Nb3VzZVVwLCBmYWxzZSApO1xyXG5cclxuXHRcdHNjb3BlLmRpc3BhdGNoRXZlbnQoIGVuZEV2ZW50ICk7XHJcblxyXG5cdFx0c3RhdGUgPSBTVEFURS5OT05FO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uTW91c2VXaGVlbCggZXZlbnQgKSB7XHJcblxyXG5cdFx0aWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSB8fCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSB8fCAoIHN0YXRlICE9PSBTVEFURS5OT05FICYmIHN0YXRlICE9PSBTVEFURS5ST1RBVEUgKSApIHJldHVybjtcclxuXHJcblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG5cdFx0aGFuZGxlTW91c2VXaGVlbCggZXZlbnQgKTtcclxuXHJcblx0XHRzY29wZS5kaXNwYXRjaEV2ZW50KCBzdGFydEV2ZW50ICk7IC8vIG5vdCBzdXJlIHdoeSB0aGVzZSBhcmUgaGVyZS4uLlxyXG5cdFx0c2NvcGUuZGlzcGF0Y2hFdmVudCggZW5kRXZlbnQgKTtcclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBvbktleURvd24oIGV2ZW50ICkge1xyXG5cclxuXHRcdGlmICggc2NvcGUuZW5hYmxlZCA9PT0gZmFsc2UgfHwgc2NvcGUuZW5hYmxlS2V5cyA9PT0gZmFsc2UgfHwgc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRoYW5kbGVLZXlEb3duKCBldmVudCApO1xyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uVG91Y2hTdGFydCggZXZlbnQgKSB7XHJcblxyXG5cdFx0aWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRzd2l0Y2ggKCBldmVudC50b3VjaGVzLmxlbmd0aCApIHtcclxuXHJcblx0XHRcdGNhc2UgMTpcdC8vIG9uZS1maW5nZXJlZCB0b3VjaDogcm90YXRlXHJcblxyXG5cdFx0XHRcdGlmICggc2NvcGUuZW5hYmxlUm90YXRlID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRcdFx0aGFuZGxlVG91Y2hTdGFydFJvdGF0ZSggZXZlbnQgKTtcclxuXHJcblx0XHRcdFx0c3RhdGUgPSBTVEFURS5UT1VDSF9ST1RBVEU7XHJcblxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSAyOlx0Ly8gdHdvLWZpbmdlcmVkIHRvdWNoOiBkb2xseVxyXG5cclxuXHRcdFx0XHRpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICkgcmV0dXJuO1xyXG5cclxuXHRcdFx0XHRoYW5kbGVUb3VjaFN0YXJ0RG9sbHkoIGV2ZW50ICk7XHJcblxyXG5cdFx0XHRcdHN0YXRlID0gU1RBVEUuVE9VQ0hfRE9MTFk7XHJcblxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSAzOiAvLyB0aHJlZS1maW5nZXJlZCB0b3VjaDogcGFuXHJcblxyXG5cdFx0XHRcdGlmICggc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRcdFx0aGFuZGxlVG91Y2hTdGFydFBhbiggZXZlbnQgKTtcclxuXHJcblx0XHRcdFx0c3RhdGUgPSBTVEFURS5UT1VDSF9QQU47XHJcblxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0ZGVmYXVsdDpcclxuXHJcblx0XHRcdFx0c3RhdGUgPSBTVEFURS5OT05FO1xyXG5cclxuXHRcdH1cclxuXHJcblx0XHRpZiAoIHN0YXRlICE9PSBTVEFURS5OT05FICkge1xyXG5cclxuXHRcdFx0c2NvcGUuZGlzcGF0Y2hFdmVudCggc3RhcnRFdmVudCApO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fVxyXG5cclxuXHRmdW5jdGlvbiBvblRvdWNoTW92ZSggZXZlbnQgKSB7XHJcblxyXG5cdFx0aWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjtcclxuXHJcblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblxyXG5cdFx0c3dpdGNoICggZXZlbnQudG91Y2hlcy5sZW5ndGggKSB7XHJcblxyXG5cdFx0XHRjYXNlIDE6IC8vIG9uZS1maW5nZXJlZCB0b3VjaDogcm90YXRlXHJcblxyXG5cdFx0XHRcdGlmICggc2NvcGUuZW5hYmxlUm90YXRlID09PSBmYWxzZSApIHJldHVybjtcclxuXHRcdFx0XHRpZiAoIHN0YXRlICE9PSBTVEFURS5UT1VDSF9ST1RBVEUgKSByZXR1cm47IC8vIGlzIHRoaXMgbmVlZGVkPy4uLlxyXG5cclxuXHRcdFx0XHRoYW5kbGVUb3VjaE1vdmVSb3RhdGUoIGV2ZW50ICk7XHJcblxyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSAyOiAvLyB0d28tZmluZ2VyZWQgdG91Y2g6IGRvbGx5XHJcblxyXG5cdFx0XHRcdGlmICggc2NvcGUuZW5hYmxlWm9vbSA9PT0gZmFsc2UgKSByZXR1cm47XHJcblx0XHRcdFx0aWYgKCBzdGF0ZSAhPT0gU1RBVEUuVE9VQ0hfRE9MTFkgKSByZXR1cm47IC8vIGlzIHRoaXMgbmVlZGVkPy4uLlxyXG5cclxuXHRcdFx0XHRoYW5kbGVUb3VjaE1vdmVEb2xseSggZXZlbnQgKTtcclxuXHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIDM6IC8vIHRocmVlLWZpbmdlcmVkIHRvdWNoOiBwYW5cclxuXHJcblx0XHRcdFx0aWYgKCBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuO1xyXG5cdFx0XHRcdGlmICggc3RhdGUgIT09IFNUQVRFLlRPVUNIX1BBTiApIHJldHVybjsgLy8gaXMgdGhpcyBuZWVkZWQ/Li4uXHJcblxyXG5cdFx0XHRcdGhhbmRsZVRvdWNoTW92ZVBhbiggZXZlbnQgKTtcclxuXHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRkZWZhdWx0OlxyXG5cclxuXHRcdFx0XHRzdGF0ZSA9IFNUQVRFLk5PTkU7XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG5cdGZ1bmN0aW9uIG9uVG91Y2hFbmQoIGV2ZW50ICkge1xyXG5cclxuXHRcdGlmICggc2NvcGUuZW5hYmxlZCA9PT0gZmFsc2UgKSByZXR1cm47XHJcblxyXG5cdFx0aGFuZGxlVG91Y2hFbmQoIGV2ZW50ICk7XHJcblxyXG5cdFx0c2NvcGUuZGlzcGF0Y2hFdmVudCggZW5kRXZlbnQgKTtcclxuXHJcblx0XHRzdGF0ZSA9IFNUQVRFLk5PTkU7XHJcblxyXG5cdH1cclxuXHJcblx0ZnVuY3Rpb24gb25Db250ZXh0TWVudSggZXZlbnQgKSB7XHJcblxyXG5cdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuXHJcblx0fVxyXG5cclxuXHQvL1xyXG5cclxuXHRzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdjb250ZXh0bWVudScsIG9uQ29udGV4dE1lbnUsIGZhbHNlICk7XHJcblxyXG5cdHNjb3BlLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ21vdXNlZG93bicsIG9uTW91c2VEb3duLCBmYWxzZSApO1xyXG5cdHNjb3BlLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3doZWVsJywgb25Nb3VzZVdoZWVsLCBmYWxzZSApO1xyXG5cclxuXHRzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaHN0YXJ0Jywgb25Ub3VjaFN0YXJ0LCBmYWxzZSApO1xyXG5cdHNjb3BlLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3RvdWNoZW5kJywgb25Ub3VjaEVuZCwgZmFsc2UgKTtcclxuXHRzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICd0b3VjaG1vdmUnLCBvblRvdWNoTW92ZSwgZmFsc2UgKTtcclxuXHJcblx0d2luZG93LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgb25LZXlEb3duLCBmYWxzZSApO1xyXG5cclxuXHQvLyBmb3JjZSBhbiB1cGRhdGUgYXQgc3RhcnRcclxuXHJcblx0dGhpcy51cGRhdGUoKTtcclxuXHJcbn07XHJcblxyXG5PcmJpdENvbnRyb2xzLnByb3RvdHlwZSA9IE9iamVjdC5jcmVhdGUoIFRIUkVFLkV2ZW50RGlzcGF0Y2hlci5wcm90b3R5cGUgKTtcclxuT3JiaXRDb250cm9scy5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBPcmJpdENvbnRyb2xzO1xyXG5cclxuT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoIE9yYml0Q29udHJvbHMucHJvdG90eXBlLCB7XHJcblxyXG5cdGNlbnRlcjoge1xyXG5cclxuXHRcdGdldDogZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdFx0Y29uc29sZS53YXJuKCAnVEhSRUUuT3JiaXRDb250cm9sczogLmNlbnRlciBoYXMgYmVlbiByZW5hbWVkIHRvIC50YXJnZXQnICk7XHJcblx0XHRcdHJldHVybiB0aGlzLnRhcmdldDtcclxuXHJcblx0XHR9XHJcblxyXG5cdH0sXHJcblxyXG5cdC8vIGJhY2t3YXJkIGNvbXBhdGliaWxpdHlcclxuXHJcblx0bm9ab29tOiB7XHJcblxyXG5cdFx0Z2V0OiBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHRjb25zb2xlLndhcm4oICdUSFJFRS5PcmJpdENvbnRyb2xzOiAubm9ab29tIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAuZW5hYmxlWm9vbSBpbnN0ZWFkLicgKTtcclxuXHRcdFx0cmV0dXJuICEgdGhpcy5lbmFibGVab29tO1xyXG5cclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0OiBmdW5jdGlvbiAoIHZhbHVlICkge1xyXG5cclxuXHRcdFx0Y29uc29sZS53YXJuKCAnVEhSRUUuT3JiaXRDb250cm9sczogLm5vWm9vbSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLmVuYWJsZVpvb20gaW5zdGVhZC4nICk7XHJcblx0XHRcdHRoaXMuZW5hYmxlWm9vbSA9ICEgdmFsdWU7XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9LFxyXG5cclxuXHRub1JvdGF0ZToge1xyXG5cclxuXHRcdGdldDogZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdFx0Y29uc29sZS53YXJuKCAnVEhSRUUuT3JiaXRDb250cm9sczogLm5vUm90YXRlIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFVzZSAuZW5hYmxlUm90YXRlIGluc3RlYWQuJyApO1xyXG5cdFx0XHRyZXR1cm4gISB0aGlzLmVuYWJsZVJvdGF0ZTtcclxuXHJcblx0XHR9LFxyXG5cclxuXHRcdHNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHtcclxuXHJcblx0XHRcdGNvbnNvbGUud2FybiggJ1RIUkVFLk9yYml0Q29udHJvbHM6IC5ub1JvdGF0ZSBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLmVuYWJsZVJvdGF0ZSBpbnN0ZWFkLicgKTtcclxuXHRcdFx0dGhpcy5lbmFibGVSb3RhdGUgPSAhIHZhbHVlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fSxcclxuXHJcblx0bm9QYW46IHtcclxuXHJcblx0XHRnZXQ6IGZ1bmN0aW9uICgpIHtcclxuXHJcblx0XHRcdGNvbnNvbGUud2FybiggJ1RIUkVFLk9yYml0Q29udHJvbHM6IC5ub1BhbiBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLmVuYWJsZVBhbiBpbnN0ZWFkLicgKTtcclxuXHRcdFx0cmV0dXJuICEgdGhpcy5lbmFibGVQYW47XHJcblxyXG5cdFx0fSxcclxuXHJcblx0XHRzZXQ6IGZ1bmN0aW9uICggdmFsdWUgKSB7XHJcblxyXG5cdFx0XHRjb25zb2xlLndhcm4oICdUSFJFRS5PcmJpdENvbnRyb2xzOiAubm9QYW4gaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIC5lbmFibGVQYW4gaW5zdGVhZC4nICk7XHJcblx0XHRcdHRoaXMuZW5hYmxlUGFuID0gISB2YWx1ZTtcclxuXHJcblx0XHR9XHJcblxyXG5cdH0sXHJcblxyXG5cdG5vS2V5czoge1xyXG5cclxuXHRcdGdldDogZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdFx0Y29uc29sZS53YXJuKCAnVEhSRUUuT3JiaXRDb250cm9sczogLm5vS2V5cyBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLmVuYWJsZUtleXMgaW5zdGVhZC4nICk7XHJcblx0XHRcdHJldHVybiAhIHRoaXMuZW5hYmxlS2V5cztcclxuXHJcblx0XHR9LFxyXG5cclxuXHRcdHNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHtcclxuXHJcblx0XHRcdGNvbnNvbGUud2FybiggJ1RIUkVFLk9yYml0Q29udHJvbHM6IC5ub0tleXMgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIC5lbmFibGVLZXlzIGluc3RlYWQuJyApO1xyXG5cdFx0XHR0aGlzLmVuYWJsZUtleXMgPSAhIHZhbHVlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fSxcclxuXHJcblx0c3RhdGljTW92aW5nIDoge1xyXG5cclxuXHRcdGdldDogZnVuY3Rpb24gKCkge1xyXG5cclxuXHRcdFx0Y29uc29sZS53YXJuKCAnVEhSRUUuT3JiaXRDb250cm9sczogLnN0YXRpY01vdmluZyBoYXMgYmVlbiBkZXByZWNhdGVkLiBVc2UgLmVuYWJsZURhbXBpbmcgaW5zdGVhZC4nICk7XHJcblx0XHRcdHJldHVybiAhIHRoaXMuZW5hYmxlRGFtcGluZztcclxuXHJcblx0XHR9LFxyXG5cclxuXHRcdHNldDogZnVuY3Rpb24gKCB2YWx1ZSApIHtcclxuXHJcblx0XHRcdGNvbnNvbGUud2FybiggJ1RIUkVFLk9yYml0Q29udHJvbHM6IC5zdGF0aWNNb3ZpbmcgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlIC5lbmFibGVEYW1waW5nIGluc3RlYWQuJyApO1xyXG5cdFx0XHR0aGlzLmVuYWJsZURhbXBpbmcgPSAhIHZhbHVlO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fSxcclxuXHJcblx0ZHluYW1pY0RhbXBpbmdGYWN0b3IgOiB7XHJcblxyXG5cdFx0Z2V0OiBmdW5jdGlvbiAoKSB7XHJcblxyXG5cdFx0XHRjb25zb2xlLndhcm4oICdUSFJFRS5PcmJpdENvbnRyb2xzOiAuZHluYW1pY0RhbXBpbmdGYWN0b3IgaGFzIGJlZW4gcmVuYW1lZC4gVXNlIC5kYW1waW5nRmFjdG9yIGluc3RlYWQuJyApO1xyXG5cdFx0XHRyZXR1cm4gdGhpcy5kYW1waW5nRmFjdG9yO1xyXG5cclxuXHRcdH0sXHJcblxyXG5cdFx0c2V0OiBmdW5jdGlvbiAoIHZhbHVlICkge1xyXG5cclxuXHRcdFx0Y29uc29sZS53YXJuKCAnVEhSRUUuT3JiaXRDb250cm9sczogLmR5bmFtaWNEYW1waW5nRmFjdG9yIGhhcyBiZWVuIHJlbmFtZWQuIFVzZSAuZGFtcGluZ0ZhY3RvciBpbnN0ZWFkLicgKTtcclxuXHRcdFx0dGhpcy5kYW1waW5nRmFjdG9yID0gdmFsdWU7XHJcblxyXG5cdFx0fVxyXG5cclxuXHR9XHJcblxyXG59ICk7XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IE9yYml0Q29udHJvbHM7XHJcbiIsImxldFxyXG5PcmJpdENvbnRyb2xzID0gcmVxdWlyZSggJy4uL2NvbnRyb2xzL09yYml0Q29udHJvbHMnICk7XHJcblxyXG5jbGFzcyBDYW1lcmFNYW5hZ2VyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgbGV0XHJcbiAgICB2aWV3QW5nbGUgPSA0NSxcclxuICAgIGFzcGVjdFJhdGlvID0gd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsXHJcbiAgICBuZWFyID0gMSxcclxuICAgIGZhciA9IDEwMDAwO1xyXG5cclxuICAgIHRoaXMuY2FtZXJhID0gbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKFxyXG4gICAgICB2aWV3QW5nbGUsIGFzcGVjdFJhdGlvLCBuZWFyLCBmYXJcclxuICAgICk7XHJcbiAgICB0aGlzLmNhbWVyYS5wb3NpdGlvbi56ID0gMzAwO1xyXG5cclxuICAgIGxldCBjb250cm9scyA9IG5ldyBPcmJpdENvbnRyb2xzKCB0aGlzLmNhbWVyYSApO1xyXG5cclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IENhbWVyYU1hbmFnZXI7XHJcbiIsImxldFxyXG5XaW5kb3dNYW5hZ2VyID0gcmVxdWlyZSggJy4vV2luZG93TWFuYWdlci5qcycgKSxcclxuUGxheWVyID0gcmVxdWlyZSggJy4vUGxheWVyLmpzJyApLFxyXG5TY2VuZU1hbmFnZXIgPSByZXF1aXJlKCAnLi9TY2VuZU1hbmFnZXIuanMnICksXHJcbkNhbWVyYU1hbmFnZXIgPSByZXF1aXJlKCAnLi9DYW1lcmFNYW5hZ2VyJyApLFxyXG5UcmFja01hbmFnZXIgPSByZXF1aXJlKCAnLi9UcmFja01hbmFnZXInICksXHJcbk5hdlRyYWNrQWdlbnQgPSByZXF1aXJlKCAnLi9OYXZUcmFja0FnZW50JyApLFxyXG5QbGF5ZXJDYW1lcmEgPSByZXF1aXJlKCAnLi9QbGF5ZXJDYW1lcmEnICk7XHJcblxyXG5jbGFzcyBHYW1lIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4gICAgdGhpcy5jdWJlcyA9IFtdO1xyXG5cclxuICAgIFRIUkVFLkFSVXRpbHMuZ2V0QVJEaXNwbGF5KCkudGhlbih0aGlzLmluaXQuYmluZCh0aGlzKSk7XHJcblxyXG4gICAgdGhpcy50cmFja01hbmFnZXIgPSBuZXcgVHJhY2tNYW5hZ2VyKCk7XHJcbiAgICB0aGlzLnRyYWNrTWFuYWdlci5hZGRFdmVudExpc3RlbmVyKCduZXdTcGxpbmUnLCB0aGlzLm5ld0N1YmVHcm91cC5iaW5kKHRoaXMpKTtcclxuICAgIC8vIHRoaXMud2luZG93TWFuYWdlciA9IG5ldyBXaW5kb3dNYW5hZ2VyKCk7XHJcbiAgICAvLyB0aGlzLnNjZW5lTWFuYWdlciA9IG5ldyBTY2VuZU1hbmFnZXIoKTtcclxuICAgIC8vIGxldCBjYW1lcmFNYW5hZ2VyID0gbmV3IENhbWVyYU1hbmFnZXIoKTtcclxuICAgIC8vIHRoaXMuY2xvY2sgPSBuZXcgVEhSRUUuQ2xvY2soKTtcclxuICAgIC8vXHJcbiAgICAvLyB0aGlzLndpbmRvd01hbmFnZXIuc2NlbmUgPSB0aGlzLnNjZW5lTWFuYWdlci5zY2VuZTtcclxuICAgIC8vIHRoaXMud2luZG93TWFuYWdlci5jYW1lcmEgPSBjYW1lcmFNYW5hZ2VyLmNhbWVyYTtcclxuICAgIC8vXHJcbiAgICAvLyB0aGlzLnRyYWNrTWFuYWdlci5yZXF1ZXN0VHJhY2tEYXRhKClcclxuICAgIC8vIC50aGVuKCB0aGlzLm9uVHJhY2tMb2FkLmJpbmQoIHRoaXMgKSApO1xyXG5cclxuICB9XHJcblxyXG4gIG5ld0N1YmVHcm91cCgpe1xyXG4gICAgdGhpcy5jdWJlcyA9IFtdO1xyXG4gIH1cclxuXHJcbiAgaW5pdChkaXNwbGF5KXtcclxuXHJcbiAgICBpZiAoZGlzcGxheSA9PT0gbnVsbCkge1xyXG4gICAgICBUSFJFRS5BUlV0aWxzLmRpc3BsYXlVbnN1cHBvcnRlZE1lc3NhZ2UoKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgdmFyIGRvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnY29udGFpbmVyJyApO1xyXG4gICAgdGhpcy52ckRpc3BsYXkgPSBkaXNwbGF5O1xyXG4gICAgdGhpcy5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKHsgYWxwaGE6IHRydWUgfSk7XHJcbiAgICB0aGlzLnNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldFBpeGVsUmF0aW8od2luZG93LmRldmljZVBpeGVsUmF0aW8pO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTtcclxuICAgIGRvbS5hcHBlbmRDaGlsZCggdGhpcy5yZW5kZXJlci5kb21FbGVtZW50ICk7XHJcbiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vbldpbmRvd1Jlc2l6ZS5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcblxyXG4gICAgdGhpcy52ckZyYW1lRGF0YSA9IG5ldyBWUkZyYW1lRGF0YSgpO1xyXG5cclxuICAgIHRoaXMuYXJWaWV3ID0gbmV3IFRIUkVFLkFSVmlldyh0aGlzLnZyRGlzcGxheSwgdGhpcy5yZW5kZXJlcik7XHJcbiAgICB0aGlzLmNhbWVyYSA9IG5ldyBUSFJFRS5BUlBlcnNwZWN0aXZlQ2FtZXJhKFxyXG4gICAgICB0aGlzLnZyRGlzcGxheSxcclxuICAgICAgNjAsXHJcbiAgICAgIHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0LFxyXG4gICAgICB0aGlzLnZyRGlzcGxheS5kZXB0aE5lYXIsXHJcbiAgICAgIHRoaXMudnJEaXNwbGF5LmRlcHRoRmFyXHJcbiAgICApO1xyXG4gICAgdGhpcy52ckNvbnRyb2xzID0gbmV3IFRIUkVFLlZSQ29udHJvbHModGhpcy5jYW1lcmEpO1xyXG5cclxuICAgIHRoaXMuY3JlYXRlQm94VGVtcGxhdGUoKTtcclxuXHJcbiAgICB0aGlzLnJlbmRlcmVyLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIHRoaXMub25DbGljay5iaW5kKHRoaXMpLCBmYWxzZSk7XHJcblxyXG4gICAgdGhpcy51cGRhdGUoKTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZUJveFRlbXBsYXRlKCl7XHJcblxyXG4gICAgdmFyIGNvbG9ycyA9IFtcclxuICAgICAgbmV3IFRIUkVFLkNvbG9yKCAweGZmZmZmZiApLFxyXG4gICAgICBuZXcgVEhSRUUuQ29sb3IoIDB4ZmZmZjAwICksXHJcbiAgICAgIG5ldyBUSFJFRS5Db2xvciggMHhmZjAwZmYgKSxcclxuICAgICAgbmV3IFRIUkVFLkNvbG9yKCAweGZmMDAwMCApLFxyXG4gICAgICBuZXcgVEhSRUUuQ29sb3IoIDB4MDBmZmZmICksXHJcbiAgICAgIG5ldyBUSFJFRS5Db2xvciggMHgwMGZmMDAgKSxcclxuICAgICAgbmV3IFRIUkVFLkNvbG9yKCAweDAwMDBmZiApLFxyXG4gICAgICBuZXcgVEhSRUUuQ29sb3IoIDB4MDAwMDAwIClcclxuICAgIF07XHJcblxyXG4gICAgdmFyIGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJveEdlb21ldHJ5KCAwLjAyNSwgMC4wNSwgMC4wMjUgKTtcclxuICAgIHZhciBmYWNlSW5kaWNlcyA9IFsnYScsICdiJywgJ2MnXTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgZ2VvbWV0cnkuZmFjZXMubGVuZ3RoOyBpKyspIHtcclxuICAgICAgdmFyIGYgID0gZ2VvbWV0cnkuZmFjZXNbaV07XHJcbiAgICAgIGZvciAodmFyIGogPSAwOyBqIDwgMzsgaisrKSB7XHJcbiAgICAgICAgdmFyIHZlcnRleEluZGV4ID0gZltmYWNlSW5kaWNlc1sgaiBdXTtcclxuICAgICAgICBmLnZlcnRleENvbG9yc1tqXSA9IGNvbG9yc1t2ZXJ0ZXhJbmRleF07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCh7IHZlcnRleENvbG9yczogVEhSRUUuVmVydGV4Q29sb3JzIH0pO1xyXG4gICAgdGhpcy5jdWJlID0gbmV3IFRIUkVFLk1lc2goZ2VvbWV0cnksIG1hdGVyaWFsKTtcclxuXHJcbiAgfVxyXG5cclxuICBvbkNsaWNrKCl7XHJcbiAgICAvLyBGZXRjaCB0aGUgcG9zZSBkYXRhIGZyb20gdGhlIGN1cnJlbnQgZnJhbWVcclxuICAgIHZhciBwb3NlID0gdGhpcy52ckZyYW1lRGF0YS5wb3NlO1xyXG5cclxuICAgIC8vIENvbnZlcnQgdGhlIHBvc2Ugb3JpZW50YXRpb24gYW5kIHBvc2l0aW9uIGludG9cclxuICAgIC8vIFRIUkVFLlF1YXRlcm5pb24gYW5kIFRIUkVFLlZlY3RvcjMgcmVzcGVjdGl2ZWx5XHJcbiAgICB2YXIgb3JpID0gbmV3IFRIUkVFLlF1YXRlcm5pb24oXHJcbiAgICAgIHBvc2Uub3JpZW50YXRpb25bMF0sXHJcbiAgICAgIHBvc2Uub3JpZW50YXRpb25bMV0sXHJcbiAgICAgIHBvc2Uub3JpZW50YXRpb25bMl0sXHJcbiAgICAgIHBvc2Uub3JpZW50YXRpb25bM11cclxuICAgICk7XHJcblxyXG4gICAgdmFyIHBvcyA9IG5ldyBUSFJFRS5WZWN0b3IzKFxyXG4gICAgICBwb3NlLnBvc2l0aW9uWzBdLFxyXG4gICAgICBwb3NlLnBvc2l0aW9uWzFdLFxyXG4gICAgICBwb3NlLnBvc2l0aW9uWzJdXHJcbiAgICApO1xyXG5cclxuICAgIHZhciBkaXJNdHggPSBuZXcgVEhSRUUuTWF0cml4NCgpO1xyXG4gICAgZGlyTXR4Lm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKG9yaSk7XHJcblxyXG4gICAgdmFyIHB1c2ggPSBuZXcgVEhSRUUuVmVjdG9yMygwLCAwLCAtMS4wKTtcclxuICAgIHB1c2gudHJhbnNmb3JtRGlyZWN0aW9uKGRpck10eCk7XHJcbiAgICBwb3MuYWRkU2NhbGVkVmVjdG9yKHB1c2gsIDAuMTI1KTtcclxuXHJcbiAgICAvLyBDbG9uZSBvdXIgY3ViZSBvYmplY3QgYW5kIHBsYWNlIGl0IGF0IHRoZSBjYW1lcmEnc1xyXG4gICAgLy8gY3VycmVudCBwb3NpdGlvblxyXG4gICAgdmFyIGNsb25lID0gdGhpcy5jdWJlLmNsb25lKCk7XHJcblxyXG4gICAgY2xvbmUucG9zaXRpb24uY29weShwb3MpO1xyXG4gICAgY2xvbmUucXVhdGVybmlvbi5jb3B5KG9yaSk7XHJcbiAgICB0aGlzLmN1YmVzLnB1c2goY2xvbmUpO1xyXG5cclxuICAgIGlmKHRoaXMuY3ViZXMubGVuZ3RoIDwgNCl7XHJcbiAgICAgIHRoaXMuc2NlbmUuYWRkKGNsb25lKTtcclxuXHJcbiAgICB9ZWxzZSBpZiAodGhpcy5jdWJlcy5sZW5ndGggPT09IDQpe1xyXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuY3ViZXMubGVuZ3RoLTE7IGkrKykge1xyXG4gICAgICAgIHZhciBjdWJlID0gdGhpcy5jdWJlc1tpXTtcclxuICAgICAgICB0aGlzLnNjZW5lLnJlbW92ZSggdGhpcy5zY2VuZS5nZXRPYmplY3RCeUlkKGN1YmUuaWQpKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMudXBkYXRlU3BsaW5lKCk7XHJcblxyXG4gIH1cclxuXHJcbiAgdXBkYXRlU3BsaW5lKCl7XHJcbiAgICBjb25zb2xlLmxvZyh0aGlzLmN1YmVzW3RoaXMuY3ViZXMubGVuZ3RoLTFdLnBvc2l0aW9uKTtcclxuICAgIGlmKHRoaXMuY3ViZXMubGVuZ3RoID4gMyl7XHJcblxyXG4gICAgICB0aGlzLnRyYWNrTWFuYWdlci51cGRhdGVDdHJsUG9pbnRzKCB0aGlzLmN1YmVzICk7XHJcblxyXG4gICAgICBpZiggdGhpcy50cmFja01hbmFnZXIubWVzaCA9PT0gdW5kZWZpbmVkICl7XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2tNYW5hZ2VyLmNyZWF0ZVBhdGgoKTtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZCggdGhpcy50cmFja01hbmFnZXIubWVzaCApO1xyXG5cclxuICAgICAgfWVsc2V7XHJcblxyXG4gICAgICAgIHRoaXMudHJhY2tNYW5hZ2VyLnVwZGF0ZVBhdGgoKTtcclxuXHJcbiAgICAgIH1cbiAgICAgIC8vIHRoaXMudHJhY2tNYW5hZ2VyLnJlcXVlc3RUcmFja0RhdGEoKVxyXG4gICAgICAvLyAudGhlbiggKCk9PntcclxuICAgICAgLy8gICB0aGlzLnNjZW5lLmFkZCggdGhpcy50cmFja01hbmFnZXIubWVzaCApO1xyXG4gICAgICAvLyB9ICk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICB1cGRhdGUoKXtcclxuICAgIHRoaXMuYXJWaWV3LnJlbmRlcigpO1xyXG4gICAgdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xyXG4gICAgdGhpcy52ckRpc3BsYXkuZ2V0RnJhbWVEYXRhKHRoaXMudnJGcmFtZURhdGEpO1xyXG4gICAgdGhpcy52ckNvbnRyb2xzLnVwZGF0ZSgpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5jbGVhckRlcHRoKCk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnJlbmRlcih0aGlzLnNjZW5lLCB0aGlzLmNhbWVyYSk7XHJcbiAgICB0aGlzLnZyRGlzcGxheS5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XHJcbiAgfVxyXG5cclxuICBvblRyYWNrTG9hZCgpIHtcclxuXHJcbiAgICB0aGlzLm5hdlRyYWNrQWdlbnQgPSBuZXcgTmF2VHJhY2tBZ2VudCggdGhpcyApO1xyXG4gICAgdGhpcy5wbGF5ZXIgPSBuZXcgUGxheWVyKCB0aGlzLm5hdlRyYWNrQWdlbnQgKTtcclxuICAgIHRoaXMucGxheWVyQ2FtZXJhID0gbmV3IFBsYXllckNhbWVyYSggdGhpcyApO1xyXG5cclxuICAgIHRoaXMucGxheWVyLnRyYWNrID0gdGhpcy50cmFja01hbmFnZXIubWVzaDtcclxuICAgIHRoaXMucGxheWVyLnVwZGF0ZVBvc2l0aW9uKCk7XHJcblxyXG4gICAgdGhpcy5zY2VuZU1hbmFnZXIuc2NlbmUuYWRkKCB0aGlzLnRyYWNrTWFuYWdlci5tZXNoICk7XHJcbiAgICB0aGlzLnNjZW5lTWFuYWdlci5zY2VuZS5hZGQoIHRoaXMucGxheWVyLm1lc2ggKTtcclxuXHJcbiAgICB0aGlzLndpbmRvd01hbmFnZXIucmVuZGVyKCk7XHJcblxyXG4gIH1cclxuXHJcbiAgZ2V0RGVsdGFUaW1lKCkge1xyXG5cclxuICAgIHJldHVybiB0aGlzLmNsb2NrLmdldERlbHRhKCk7XHJcblxyXG4gIH1cclxuXHJcbiAgb25XaW5kb3dSZXNpemUoKXtcclxuICAgIHRoaXMuY2FtZXJhLmFzcGVjdCA9IHdpbmRvdy5pbm5lcldpZHRoIC8gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTaXplKHdpbmRvdy5pbm5lcldpZHRoLCB3aW5kb3cuaW5uZXJIZWlnaHQpO1xyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gR2FtZTtcclxuIiwibGV0IEV2ZW50RGlzcGF0Y2hlciA9IHJlcXVpcmUoICcuLi8uLi92ZW5kb3IvRXZlbnREaXNwYXRjaGVyLmpzJyApO1xyXG5cclxuY2xhc3MgTmF2VHJhY2tBZ2VudCBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCBnYW1lICkge1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5nYW1lID0gZ2FtZTtcclxuICAgIHRoaXMudHJhY2sgPSBnYW1lLnRyYWNrTWFuYWdlcjtcclxuICAgIHRoaXMuX2N1cnJlbnREaXN0YW5jZSA9IDA7XHJcblxyXG4gICAgdGhpcy5zcGVlZCA9IDE1MDtcclxuXHJcbiAgICBnYW1lLndpbmRvd01hbmFnZXIuYWRkRXZlbnRMaXN0ZW5lciggJ29uUHJlUmVuZGVyJywgdGhpcy51cGRhdGUuYmluZCggdGhpcyApICk7XHJcblxyXG4gIH1cclxuXHJcbiAgdXBkYXRlKCkge1xyXG5cclxuICAgIHRoaXMuY3VycmVudERpc3RhbmNlID0gKFxyXG4gICAgICB0aGlzLl9jdXJyZW50RGlzdGFuY2UgKyB0aGlzLnNwZWVkICogdGhpcy5nYW1lLmdldERlbHRhVGltZSgpXHJcbiAgICApICUgdGhpcy50cmFjay5nZXRMZW5ndGgoKTtcclxuXHJcbiAgfVxyXG5cclxuICBnZXQgY3VycmVudERpc3RhbmNlKCkge1xyXG5cclxuICAgIHJldHVybiB0aGlzLl9jdXJyZW50RGlzdGFuY2U7XHJcblxyXG4gIH1cclxuXHJcbiAgc2V0IGN1cnJlbnREaXN0YW5jZSggdmFsdWUgKSB7XHJcblxyXG4gICAgdGhpcy5fY3VycmVudERpc3RhbmNlID0gdmFsdWU7XHJcbiAgICB0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2NoYW5nZScgfSApO1xyXG5cclxuICB9XHJcblxyXG4gIGdldCBhbW91bnRUcmF2ZWxlZCgpIHtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fY3VycmVudERpc3RhbmNlIC8gdGhpcy50cmFjay5nZXRMZW5ndGgoKTtcclxuXHJcbiAgfVxyXG5cclxuICBuZXh0QW1vdW50VHJhdmVsZWQoIGFkZCApIHtcclxuXHJcbiAgICB2YXIgbmV4dCA9ICggdGhpcy5fY3VycmVudERpc3RhbmNlICsgYWRkICkgLyB0aGlzLnRyYWNrLmdldExlbmd0aCgpO1xyXG5cclxuICAgIHJldHVybiBuZXh0IDwgMSA/IG5leHQgOiAxO1xyXG5cclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IE5hdlRyYWNrQWdlbnQ7XHJcbiIsImNsYXNzIFBsYXllciB7XHJcblxyXG4gIGNvbnN0cnVjdG9yICggbmF2VHJhY2tBZ2VudCApIHtcclxuXHJcbiAgICB0aGlzLm5hdlRyYWNrQWdlbnQgPSBuYXZUcmFja0FnZW50O1xyXG5cclxuICAgIHZhciBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMSwgMywgMTAgKTtcclxuICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoQmFzaWNNYXRlcmlhbCgge2NvbG9yOiAweDAwZmYwMH0gKTtcclxuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcclxuXHJcbiAgICB0aGlzLm1lc2guYWRkKCBuZXcgVEhSRUUuQXhpc0hlbHBlciggMjAgKSApO1xyXG5cclxuICAgIHRoaXMubmF2VHJhY2tBZ2VudC5hZGRFdmVudExpc3RlbmVyKFxyXG4gICAgICAnY2hhbmdlJyxcclxuICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbi5iaW5kKCB0aGlzIClcclxuICAgICk7XHJcblxyXG4gIH1cclxuXHJcbiAgdXBkYXRlUG9zaXRpb24oKSB7XHJcblxyXG4gICAgdmFyIGFtb3VudFRyYXZlbGVkID0gdGhpcy5uYXZUcmFja0FnZW50LmFtb3VudFRyYXZlbGVkO1xyXG5cclxuICAgIHZhciBwb3MgPSB0aGlzLnRyYWNrLmdlb21ldHJ5LmdldFBvaW50QXQoIGFtb3VudFRyYXZlbGVkICk7XHJcblxyXG4gICAgdmFyIG5vcm1hbCA9IHRoaXMudHJhY2suZ2VvbWV0cnkuZ2V0Tm9ybWFsQXQoIGFtb3VudFRyYXZlbGVkICk7XHJcblxyXG4gICAgdmFyIGZvcndhcmQgPSB0aGlzLnRyYWNrLmdlb21ldHJ5LmdldFRhbmdlbnQoIGFtb3VudFRyYXZlbGVkICk7XHJcblxyXG4gICAgdGhpcy5tZXNoLnBvc2l0aW9uLmNvcHkoIHBvcyApXHJcbiAgICAuYWRkKFxyXG4gICAgICBuZXcgVEhSRUUuVmVjdG9yMygpXHJcbiAgICAgIC5hZGRTY2FsZWRWZWN0b3IoIG5vcm1hbCwgMTAgKVxyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLm1lc2gudXAgPSBub3JtYWw7XHJcblxyXG4gICAgdmFyIG0xID0gbmV3IFRIUkVFLk1hdHJpeDQoKTtcclxuICAgIG0xLmxvb2tBdCggZm9yd2FyZCwgbmV3IFRIUkVFLlZlY3RvcjMoKSwgbm9ybWFsICk7XHJcbiAgICB0aGlzLm1lc2gucXVhdGVybmlvbi5zZXRGcm9tUm90YXRpb25NYXRyaXgoIG0xICk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUGxheWVyO1xyXG4iLCJjbGFzcyBQbGF5ZXJDYW1lcmEge1xyXG5cclxuICBjb25zdHJ1Y3RvciggZ2FtZSApIHtcclxuXHJcbiAgICB0aGlzLm1hcmdpbiA9IHtcclxuICAgICAgYmFjazogLTIwLFxyXG4gICAgICB0b3A6IDIwXHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMuZ2FtZSA9IGdhbWU7XHJcbiAgICB0aGlzLnNjZW5lID0gZ2FtZS5zY2VuZU1hbmFnZXIuc2NlbmU7XHJcbiAgICB0aGlzLnRyYWNrID0gZ2FtZS50cmFja01hbmFnZXIubWVzaDtcclxuICAgIHRoaXMubmF2VHJhY2tBZ2VudCA9IGdhbWUubmF2VHJhY2tBZ2VudDtcclxuXHJcbiAgICB2YXIgZ2VvbWV0cnkgPSBuZXcgVEhSRUUuQm94R2VvbWV0cnkoIDEsIDMsIDEwICk7XHJcbiAgICB2YXIgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHgwMDAwZmZ9ICk7XHJcblxyXG4gICAgdGhpcy5oZWxwZXJDYW1lcmFNZXNoID0gbmV3IFRIUkVFLk1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApO1xyXG4gICAgdGhpcy5oZWxwZXJDYW1lcmFNZXNoLmFkZCggbmV3IFRIUkVFLkF4aXNIZWxwZXIoIDEwICkgKTtcclxuICAgIHRoaXMucG9zaXRpb24gPSB0aGlzLmhlbHBlckNhbWVyYU1lc2gucG9zaXRpb247XHJcblxyXG4gICAgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaEJhc2ljTWF0ZXJpYWwoIHtjb2xvcjogMHhmZjAwMDB9ICk7XHJcbiAgICBnZW9tZXRyeSA9IG5ldyBUSFJFRS5Cb3hHZW9tZXRyeSggMywgMywgMyApO1xyXG5cclxuICAgIHRoaXMuaGVscGVyVGFyZ2V0TWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTtcclxuICAgIHRoaXMuaGVscGVyVGFyZ2V0TWVzaC5hZGQoIG5ldyBUSFJFRS5BeGlzSGVscGVyKCAxMCApICk7XHJcbiAgICB0aGlzLnRhcmdldFBvc2l0aW9uID0gdGhpcy5oZWxwZXJUYXJnZXRNZXNoLnBvc2l0aW9uO1xyXG5cclxuICAgIHRoaXMuc2NlbmUuYWRkKCB0aGlzLmhlbHBlckNhbWVyYU1lc2ggKTtcclxuICAgIHRoaXMuc2NlbmUuYWRkKCB0aGlzLmhlbHBlclRhcmdldE1lc2ggKTtcclxuXHJcbiAgICB0aGlzLm5hdlRyYWNrQWdlbnQuYWRkRXZlbnRMaXN0ZW5lcihcclxuICAgICAgJ2NoYW5nZScsXHJcbiAgICAgIHRoaXMudXBkYXRlUG9zaXRpb24uYmluZCggdGhpcyApXHJcbiAgICApO1xyXG5cclxuICB9XHJcblxyXG4gIHVwZGF0ZVBvc2l0aW9uKCkge1xyXG5cclxuICAgIHZhciBzY29wZSA9IHRoaXM7XHJcbiAgICB2YXIgYW1vdW50VHJhdmVsZWQgPSB0aGlzLm5hdlRyYWNrQWdlbnQuYW1vdW50VHJhdmVsZWQ7XHJcbiAgICB2YXIgcG9zID0gdGhpcy50cmFjay5nZW9tZXRyeS5nZXRQb2ludEF0KCBhbW91bnRUcmF2ZWxlZCApO1xyXG4gICAgdmFyIG5vcm1hbCA9IHRoaXMudHJhY2suZ2VvbWV0cnkuZ2V0Tm9ybWFsQXQoIGFtb3VudFRyYXZlbGVkICk7XHJcbiAgICB2YXIgZm9yd2FyZCA9IHRoaXMudHJhY2suZ2VvbWV0cnkuZ2V0VGFuZ2VudCggYW1vdW50VHJhdmVsZWQgKTtcclxuICAgIHZhciBuZXh0ID0gdGhpcy5uYXZUcmFja0FnZW50Lm5leHRBbW91bnRUcmF2ZWxlZCggNzUgKTtcclxuICAgIHZhciBsb29rQXRQb3MgPSB0aGlzLnRyYWNrLmdlb21ldHJ5LmdldFBvaW50QXQoIG5leHQgKTtcclxuXHJcbiAgICB1cGRhdGVDYW1lcmFQb3MoKTtcclxuICAgIHVwZGF0ZUNhbWVyYVJvdGF0aW9uKCk7XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlQ2FtZXJhUG9zKCkge1xyXG5cclxuICAgICAgdmFyIGNhbWVyYVBvc2l0aW9uID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5jb3B5KCBwb3MgKVxyXG4gICAgICAuYWRkU2NhbGVkVmVjdG9yKCBmb3J3YXJkLCBzY29wZS5tYXJnaW4uYmFjayApXHJcbiAgICAgIC5hZGRTY2FsZWRWZWN0b3IoIG5vcm1hbCwgc2NvcGUubWFyZ2luLnRvcCApO1xyXG5cclxuICAgICAgc2NvcGUucG9zaXRpb24uY29weSggY2FtZXJhUG9zaXRpb24gKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdXBkYXRlQ2FtZXJhUm90YXRpb24oKSB7XHJcblxyXG4gICAgICBzY29wZS5oZWxwZXJDYW1lcmFNZXNoLmxvb2tBdCggbG9va0F0UG9zICk7XHJcblxyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXllckNhbWVyYTtcclxuIiwiY2xhc3MgU2NlbmVNYW5hZ2VyIHtcclxuXHJcbiAgY29uc3RydWN0b3IoKXtcclxuXHJcbiAgICB0aGlzLmNyZWF0ZVNjZW5lKCk7XHJcbiAgICAvLyB0aGlzLmFkZEhlbHBlcnMoKTtcclxuICAgIHRoaXMuYWRkTGlnaHRzKCk7XHJcblxyXG4gIH1cclxuXHJcbiAgY3JlYXRlU2NlbmUoKSB7XHJcblxyXG4gICAgdGhpcy5zY2VuZSA9IG5ldyBUSFJFRS5TY2VuZSgpO1xyXG5cclxuICB9XHJcblxyXG4gIGFkZEhlbHBlcnMoKSB7XHJcblxyXG4gICAgdGhpcy5zY2VuZS5hZGQoIG5ldyBUSFJFRS5BeGlzSGVscGVyKCAyMCApICk7XHJcblxyXG4gIH1cclxuXHJcbiAgYWRkTGlnaHRzKCkge1xyXG5cclxuICAgIHZhciBsaWdodCA9IG5ldyBUSFJFRS5TcG90TGlnaHQoIDB4ZmZmZmZmLCAxLjUgKTtcclxuICAgIGxpZ2h0LnBvc2l0aW9uLnNldCggMCwgMTUwMCwgMjAwICk7XHJcbiAgICBsaWdodC5jYXN0U2hhZG93ID0gdHJ1ZTtcclxuICAgIGxpZ2h0LnNoYWRvdyA9IG5ldyBUSFJFRS5MaWdodFNoYWRvdyggbmV3IFRIUkVFLlBlcnNwZWN0aXZlQ2FtZXJhKCA3MCwgMSwgMjAwLCAyMDAwICkgKTtcclxuICAgIGxpZ2h0LnNoYWRvdy5iaWFzID0gLTAuMDAwMjIyO1xyXG4gICAgbGlnaHQuc2hhZG93Lm1hcFNpemUud2lkdGggPSAxMDI0O1xyXG4gICAgbGlnaHQuc2hhZG93Lm1hcFNpemUuaGVpZ2h0ID0gMTAyNDtcclxuXHJcbiAgICB0aGlzLnNjZW5lLmFkZCggbGlnaHQgKTtcclxuXHJcbiAgfVxyXG5cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBTY2VuZU1hbmFnZXI7XHJcbiIsImNsYXNzIExpbmVhclRyYW5zdGl0aW9uIHtcclxuXHJcbiAgY29uc3RydWN0b3IoIHBvaW50cyApIHtcclxuXHJcbiAgICB0aGlzLnBvaW50cyA9IHBvaW50cztcclxuXHJcbiAgfVxyXG5cclxuICBnZXRQb2ludEF0ICggYXQgKSB7XHJcblxyXG4gICAgbGV0IG1heEluZGV4ID0gdGhpcy5wb2ludHMubGVuZ3RoIC0gMTtcclxuXHJcbiAgICBsZXQgaSA9IHBhcnNlSW50KCBhdCAqIG1heEluZGV4ICk7XHJcblxyXG4gICAgbGV0IGkyID0gKCBpIDwgbWF4SW5kZXggLSAxICkgPyBpICsgMSA6IGk7XHJcblxyXG4gICAgbGV0IHJlc3QgPSAoIGF0ICogbWF4SW5kZXggKSAlIDE7XHJcblxyXG4gICAgbGV0IHBvaW50MSA9IG5ldyBUSFJFRS5WZWN0b3IzKClcclxuICAgIC5jb3B5KCB0aGlzLnBvaW50c1sgaSBdIClcclxuICAgIC5tdWx0aXBseVNjYWxhciggMSAtIHJlc3QgKTtcclxuXHJcbiAgICBsZXQgcG9pbnQyID0gbmV3IFRIUkVFLlZlY3RvcjMoKVxyXG4gICAgLmNvcHkoIHRoaXMucG9pbnRzWyBpMiBdIClcclxuICAgIC5tdWx0aXBseVNjYWxhciggcmVzdCApO1xyXG5cclxuICAgIGxldCBwb2ludEF0ID0gbmV3IFRIUkVFLlZlY3RvcjMoKVxyXG4gICAgLmFkZFZlY3RvcnMoIHBvaW50MSwgcG9pbnQyIClcclxuICAgIC5ub3JtYWxpemUoKTtcclxuXHJcbiAgICByZXR1cm4gcG9pbnRBdDtcclxuXHJcbiAgfVxyXG5cclxufVxyXG5cclxuY2xhc3MgVHJhY2tHZW9tZXRyeSBleHRlbmRzIFRIUkVFLkJ1ZmZlckdlb21ldHJ5IHtcclxuXHJcbiAgY29uc3RydWN0b3IoIGN0cmxQb2ludHMsIGN0cmxOb3JtYWxzLCB3aWR0aCwgc2VnbWVudHMgKSB7XHJcblxyXG4gICAgc3VwZXIoKTtcclxuXHJcbiAgICB0aGlzLnR5cGUgPSAnVHJhY2tHZW9tZXRyeSc7XHJcbiAgICB0aGlzLmN0cmxQb2ludHMgPSBjdHJsUG9pbnRzO1xyXG4gICAgdGhpcy5jdHJsTm9ybWFscyA9IGN0cmxOb3JtYWxzO1xyXG4gICAgdGhpcy53aWR0aCA9IHdpZHRoO1xyXG4gICAgdGhpcy5zZWdtZW50cyA9IHNlZ21lbnRzO1xyXG5cclxuICAgIHRoaXMuZ2V0UG9pbnRBdCA9IGdldFBvaW50QXQ7XHJcbiAgICB0aGlzLmdldE5vcm1hbEF0ID0gZ2V0Tm9ybWFsQXQ7XHJcbiAgICB0aGlzLnVwZGF0ZUNvbnRyb2xQb2ludHMgPSB1cGRhdGVDb250cm9sUG9pbnRzO1xyXG4gICAgdGhpcy5nZW5lcmF0ZVZlcnRpY2VzID0gZ2VuZXJhdGVWZXJ0aWNlcztcclxuICAgIHRoaXMuZ2V0TGVuZ3RoID0gZ2V0TGVuZ3RoO1xyXG4gICAgdGhpcy5nZXRUYW5nZW50ID0gZ2V0VGFuZ2VudDtcclxuXHJcbiAgICBsZXRcclxuICAgIGNlbnRlclNwbGluZSA9IG5ldyBUSFJFRS5DYXRtdWxsUm9tQ3VydmUzKCBjdHJsUG9pbnRzICksXHJcbiAgICBub3JtYWxTcGxpbmUgPSBuZXcgTGluZWFyVHJhbnN0aXRpb24oIGN0cmxOb3JtYWxzICksXHJcbiAgICBzY29wZSA9IHRoaXM7XHJcblxyXG4gICAgbm9ybWFsU3BsaW5lLnRlbnNpb24gPSAwO1xyXG5cclxuICAgIGdlbmVyYXRlVmVydGljZXMoKTtcclxuXHJcbiAgICBmdW5jdGlvbiBnZW5lcmF0ZVZlcnRpY2VzKCkge1xyXG5cclxuICAgICAgLy8gYnVmZmVyc1xyXG5cclxuICAgICAgbGV0XHJcbiAgICAgIGluZGljZXMgPSBbXSxcclxuICAgICAgdmVydGljZXMgPSBbXSxcclxuICAgICAgbm9ybWFscyA9IFtdLFxyXG4gICAgICB1dnMgPSBbXTtcclxuXHJcbiAgICAgIC8vIEdlbmVyYXRlIHZlcnRpY2VzXHJcblxyXG4gICAgICBsZXRcclxuICAgICAgY2VudGVyTGluZSA9IGNlbnRlclNwbGluZS5nZXRQb2ludHMoIHNjb3BlLnNlZ21lbnRzICksXHJcbiAgICAgIGxlZnRWID0gW10sXHJcbiAgICAgIHJpZ2h0ViA9IFtdLFxyXG4gICAgICBub3JtYWxzMiA9IFtdO1xyXG5cclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc2NvcGUuc2VnbWVudHMgKyAxOyBpICsrICkge1xyXG5cclxuICAgICAgICBsZXQgZm9yd2FyZCA9IGNlbnRlclNwbGluZS5nZXRUYW5nZW50KCBpIC8gc2NvcGUuc2VnbWVudHMgKTtcclxuICAgICAgICBsZXQgdXAgPSBub3JtYWxTcGxpbmUuZ2V0UG9pbnRBdCggaSAvIHNjb3BlLnNlZ21lbnRzICk7XHJcblxyXG4gICAgICAgIGxldCByaWdodCA9IG5ldyBUSFJFRS5WZWN0b3IzKClcclxuICAgICAgICAuY3Jvc3NWZWN0b3JzKCBmb3J3YXJkLCB1cCApXHJcbiAgICAgICAgLm5vcm1hbGl6ZSgpXHJcbiAgICAgICAgLm11bHRpcGx5U2NhbGFyKCBzY29wZS53aWR0aCAqIDAuNSApO1xyXG5cclxuICAgICAgICBsZXQgcmlnaHRQb2ludCA9IG5ldyBUSFJFRS5WZWN0b3IzKClcclxuICAgICAgICAuYWRkVmVjdG9ycyggY2VudGVyTGluZVsgaSBdLCByaWdodCApO1xyXG5cclxuICAgICAgICBsZXQgbGVmdFBvaW50ID0gbmV3IFRIUkVFLlZlY3RvcjMoKVxyXG4gICAgICAgIC5zdWJWZWN0b3JzKCBjZW50ZXJMaW5lWyBpIF0sIHJpZ2h0ICk7XHJcblxyXG4gICAgICAgIGxlZnRWLnB1c2goIGxlZnRQb2ludC50b0FycmF5KCkgKTtcclxuXHJcbiAgICAgICAgcmlnaHRWLnB1c2goIHJpZ2h0UG9pbnQudG9BcnJheSgpICk7XHJcblxyXG4gICAgICAgIGxldCBub3JtYWwgPSBuZXcgVEhSRUUuVmVjdG9yMygpLmNyb3NzVmVjdG9ycyggcmlnaHQsIGZvcndhcmQgKS5ub3JtYWxpemUoKTtcclxuXHJcbiAgICAgICAgbm9ybWFscy5wdXNoKCBub3JtYWwudG9BcnJheSgpICk7XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICBsZXQgdG90YWxEaXN0YW5jZSA9IDA7XHJcblxyXG5cclxuICAgICAgZm9yICggbGV0IGkgPSAwOyBpIDwgc2NvcGUuc2VnbWVudHM7IGkgKysgKSB7XHJcblxyXG4gICAgICAgIHZlcnRpY2VzLnB1c2goIC4uLmxlZnRWWyBpIF0sIC4uLnJpZ2h0VlsgaSBdLCAuLi5sZWZ0VlsgaSArIDEgXSApO1xyXG4gICAgICAgIHZlcnRpY2VzLnB1c2goIC4uLmxlZnRWWyBpICsgMSBdLCAuLi5yaWdodFZbIGkgXSwgLi4ucmlnaHRWWyBpICsgMSBdICk7XHJcblxyXG4gICAgICAgIG5vcm1hbHMyLnB1c2goIC4uLm5vcm1hbHNbIGkgXSwgLi4ubm9ybWFsc1sgaSBdLCAuLi5ub3JtYWxzWyBpICsgMSBdICk7XHJcbiAgICAgICAgbm9ybWFsczIucHVzaCggLi4ubm9ybWFsc1sgaSArIDEgXSwgLi4ubm9ybWFsc1sgaSBdLCAuLi5ub3JtYWxzWyBpICsgMSBdICk7XHJcblxyXG4gICAgICAgIGxldCBkaXN0YW5jZSA9IGNlbnRlckxpbmVbIGkgXS5kaXN0YW5jZVRvKCBjZW50ZXJMaW5lWyBpICsgMSBdICkgLyBzY29wZS53aWR0aDtcclxuICAgICAgICB0b3RhbERpc3RhbmNlICs9IGRpc3RhbmNlO1xyXG4gICAgICAgIHV2cy5wdXNoKFxyXG4gICAgICAgICAgMCwgMCxcclxuICAgICAgICAgIDEsIDAsXHJcbiAgICAgICAgICAwLCB0b3RhbERpc3RhbmNlXHJcbiAgICAgICAgKTtcclxuICAgICAgICB1dnMucHVzaChcclxuICAgICAgICAgIDAsIHRvdGFsRGlzdGFuY2UsXHJcbiAgICAgICAgICAxLCAwLFxyXG4gICAgICAgICAgMSwgdG90YWxEaXN0YW5jZVxyXG4gICAgICAgICk7XHJcblxyXG4gICAgICB9XHJcblxyXG4gICAgICBzY29wZS5hZGRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBUSFJFRS5GbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7XHJcblxyXG4gICAgICBzY29wZS5hZGRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgVEhSRUUuRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsczIsIDMgKSApO1xyXG5cclxuICAgICAgc2NvcGUuYWRkQXR0cmlidXRlKCAndXYnLCBuZXcgVEhSRUUuRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0Tm9ybWFsQXQoIHQgKSB7XHJcblxyXG4gICAgICByZXR1cm4gbm9ybWFsU3BsaW5lLmdldFBvaW50QXQoIHQgKTtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZ2V0UG9pbnRBdCggdCApIHtcclxuXHJcbiAgICAgIHJldHVybiBjZW50ZXJTcGxpbmUuZ2V0UG9pbnRBdCggdCApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRMZW5ndGgoKSB7XHJcblxyXG4gICAgICByZXR1cm4gY2VudGVyU3BsaW5lLmdldExlbmd0aCgpO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBnZXRUYW5nZW50KCB0ICkge1xyXG5cclxuICAgICAgcmV0dXJuIGNlbnRlclNwbGluZS5nZXRUYW5nZW50KCB0ICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHVwZGF0ZUNvbnRyb2xQb2ludHMoIGN0cmxQb2ludHMsIG5vcm1hbFBvaW50cyApIHtcclxuXHJcbiAgICAgIGNlbnRlclNwbGluZSA9IG5ldyBUSFJFRS5DYXRtdWxsUm9tQ3VydmUzKCBjdHJsUG9pbnRzICk7XHJcbiAgICAgIGlmICggdHlwZW9mIG5vcm1hbFBvaW50cyAhPSAndW5kZWZpbmVkJyApIHtcclxuXHJcbiAgICAgICAgbm9ybWFsU3BsaW5lID0gbmV3IExpbmVhclRyYW5zdGl0aW9uKCBub3JtYWxQb2ludHMgKTtcclxuICAgICAgICBub3JtYWxTcGxpbmUudGVuc2lvbiA9IDA7XHJcblxyXG4gICAgICB9XHJcbiAgICAgIGdlbmVyYXRlVmVydGljZXMoKTtcclxuXHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gVHJhY2tHZW9tZXRyeTtcclxuIiwiY29uc3QgVHJhY2tHZW9tZXRyeSA9IHJlcXVpcmUoICcuL1RyYWNrR2VvbWV0cnkuanMnICk7XHJcblxyXG5jbGFzcyBUcmFja01hbmFnZXIgZXh0ZW5kcyBUSFJFRS5FdmVudERpc3BhdGNoZXIge1xyXG5cclxuICBjb25zdHJ1Y3Rvcigpe1xyXG4gICAgc3VwZXIoKTtcclxuICAgIHRoaXMuX3dpZHRoID0gMC4wMTtcclxuICAgIHRoaXMuc2VnbWVudHMgPSAzMDA7XHJcbiAgICB0aGlzLmVkaXRvciA9IHRydWU7XHJcbiAgfVxyXG5cclxuICBnZXQgd2lkdGgoKXtcclxuICAgIHJldHVybiB0aGlzLl93aWR0aDtcclxuICB9XHJcblxyXG4gIHNldCB3aWR0aCh2YWx1ZSl7XHJcbiAgICB0aGlzLl93aWR0aCA9IHZhbHVlO1xyXG4gICAgdGhpcy51cGRhdGVQYXRoKCk7XHJcbiAgfVxyXG5cclxuICByZXF1ZXN0VHJhY2tEYXRhKCkgeyByZXR1cm4gbmV3IFByb21pc2UoICggcmVzb2x2ZSApID0+IHtcclxuXHJcbiAgICAkLmdldEpTT04oICdkYXRhL2xldmVsMDEuanNvbicpXHJcbiAgICAuZG9uZSggKGRhdGEgKSA9PntcclxuXHJcbiAgICAgIHRoaXMub25UcmFja0RhdGFSZXNwb25zZSggZGF0YSApO1xyXG4gICAgICByZXNvbHZlKCk7XHJcblxyXG4gICAgfSApO1xyXG5cclxuICB9ICk7IH1cclxuXHJcbiAgb25UcmFja0RhdGFSZXNwb25zZSggZGF0YSApIHtcclxuXHJcbiAgICB0aGlzLmN0cmxQb2ludHMgPSBbXTtcclxuICAgIHRoaXMuY3RybE5vcm1hbHMgPSBbXTtcclxuXHJcbiAgICBsZXQgaSA9IDA7XHJcblxyXG4gICAgZm9yICggaSA9IDA7IGkgPCBkYXRhLmN0cmxQb2ludHMubGVuZ3RoOyBpKysgKSB7XHJcblxyXG4gICAgICBsZXQgcG9pbnRBcnJheSA9IGRhdGEuY3RybFBvaW50c1tpXTtcclxuICAgICAgbGV0IHBvaW50VmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5mcm9tQXJyYXkoIHBvaW50QXJyYXkgKTtcclxuICAgICAgdGhpcy5jdHJsUG9pbnRzLnB1c2goIHBvaW50VmVjdG9yICk7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIGZvciAoIGkgPSAwOyBpIDwgZGF0YS5jdHJsTm9ybWFscy5sZW5ndGg7IGkrKyApIHtcclxuXHJcbiAgICAgIGxldCBwb2ludEFycmF5ID0gZGF0YS5jdHJsTm9ybWFsc1tpXTtcclxuICAgICAgbGV0IHBvaW50VmVjdG9yID0gbmV3IFRIUkVFLlZlY3RvcjMoKS5mcm9tQXJyYXkoIHBvaW50QXJyYXkgKTtcclxuICAgICAgdGhpcy5jdHJsTm9ybWFscy5wdXNoKCBwb2ludFZlY3RvciApO1xyXG5cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLmNyZWF0ZVBhdGgoKTtcclxuXHJcbiAgfVxyXG5cclxuICBjcmVhdGVQYXRoKCkge1xyXG5cclxuICAgIHZhciBwYXRoR2VvbWV0cnkgPSBuZXcgVHJhY2tHZW9tZXRyeShcclxuICAgICAgdGhpcy5jdHJsUG9pbnRzLFxyXG4gICAgICB0aGlzLmN0cmxOb3JtYWxzLFxyXG4gICAgICB0aGlzLl93aWR0aCxcclxuICAgICAgdGhpcy5zZWdtZW50c1xyXG4gICAgKTtcclxuICAgIHZhciBtYXRlcmlhbCA9IG5ldyBUSFJFRS5NZXNoTm9ybWFsTWF0ZXJpYWwoKTtcclxuICAgIG1hdGVyaWFsLnNpZGUgPSBUSFJFRS5Eb3VibGVTaWRlO1xyXG4gICAgLy8gbWF0ZXJpYWwud2lyZWZyYW1lID0gdHJ1ZTtcclxuICAgIHRoaXMubWVzaCA9IG5ldyBUSFJFRS5NZXNoKCBwYXRoR2VvbWV0cnksIG1hdGVyaWFsICk7XHJcblxyXG4gICAgaWYoIHRoaXMuZWRpdG9yICl7XHJcbiAgICAgIHRoaXMuYWRkRWRpdG9yKCk7XHJcbiAgICB9XHJcblxyXG4gIH1cclxuXHJcbiAgYWRkRWRpdG9yKCl7XHJcbiAgICB0aGlzLmd1aSA9IG5ldyBkYXQuR1VJKCk7XHJcbiAgICB0aGlzLmd1aS5hZGQodGhpcywgJ3dpZHRoJywgMC4wMDAwMDEsIDAuNSk7XHJcbiAgICB0aGlzLmd1aS5hZGQodGhpcywgJ3N0YXJ0TmV3U3BsaW5lJyk7XHJcbiAgfVxyXG5cclxuICBzdGFydE5ld1NwbGluZSgpe1xyXG4gICAgdmFyIG1lc2hDb3B5ID0gdGhpcy5tZWhzO1xyXG4gICAgdGhpcy5tZXNoID0gdW5kZWZpbmVkO1xyXG4gICAgdGhpcy5ndWkuZGVzdHJveSgpO1xyXG4gICAgdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICduZXdTcGxpbmUnIH0gKTtcclxuICB9XHJcblxyXG4gIHVwZGF0ZVBhdGgoKXtcclxuICAgIHRoaXMubWVzaC5nZW9tZXRyeS5kaXNwb3NlKCk7XHJcblxyXG4gICAgdGhpcy5tZXNoLmdlb21ldHJ5ID0gbmV3IFRyYWNrR2VvbWV0cnkoXHJcbiAgICAgIHRoaXMuY3RybFBvaW50cyxcclxuICAgICAgdGhpcy5jdHJsTm9ybWFscyxcclxuICAgICAgdGhpcy5fd2lkdGgsXHJcbiAgICAgIHRoaXMuc2VnbWVudHNcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICB1cGRhdGVDdHJsUG9pbnRzKHBvaW50cyl7XHJcbiAgICB0aGlzLmN0cmxQb2ludHMgPSBbXTtcclxuICAgIHRoaXMuY3RybE5vcm1hbHMgPSBbXTtcclxuICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgICAgIHZhciBwb2ludCA9IHBvaW50c1tpXTtcclxuICAgICAgdGhpcy5jdHJsUG9pbnRzLnB1c2gocG9pbnQucG9zaXRpb24pO1xyXG5cclxuICAgICAgdmFyIG1hdHJpeCA9IG5ldyBUSFJFRS5NYXRyaXg0KCk7XHJcbiAgICAgIG1hdHJpeC5leHRyYWN0Um90YXRpb24oIHBvaW50Lm1hdHJpeCApO1xuICAgICAgdmFyIGRpcmVjdGlvbiA9IG5ldyBUSFJFRS5WZWN0b3IzKCAwLCAxLCAwICkuYXBwbHlNYXRyaXg0KG1hdHJpeCk7XHJcbiAgICAgIHRoaXMuY3RybE5vcm1hbHMucHVzaChkaXJlY3Rpb24pO1xyXG4gICAgfVxyXG5cclxuICB9XHJcblxyXG4gIGdldExlbmd0aCgpIHtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5tZXNoLmdlb21ldHJ5LmdldExlbmd0aCgpO1xyXG5cclxuICB9XHJcblxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFRyYWNrTWFuYWdlcjtcclxuIiwibGV0IEV2ZW50RGlzcGF0Y2hlciA9IHJlcXVpcmUoICcuLi8uLi92ZW5kb3IvRXZlbnREaXNwYXRjaGVyLmpzJyApO1xyXG5cclxuY2xhc3MgV2luZG93TWFuYWdlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7XHJcblxyXG4gIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuICAgIHN1cGVyKCk7XHJcblxyXG4gICAgdGhpcy5jcmVhdGVXaW5kb3coKTtcclxuXHJcbiAgfVxyXG5cclxuICBjcmVhdGVXaW5kb3coKSB7XHJcblxyXG4gICAgdmFyIGRvbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCAnY29udGFpbmVyJyApO1xyXG4gICAgdGhpcy5yZW5kZXJlciA9IG5ldyBUSFJFRS5XZWJHTFJlbmRlcmVyKCk7XHJcbiAgICB0aGlzLnJlbmRlcmVyLnNldENsZWFyQ29sb3IoIDB4ZjBmMGYwICk7XHJcbiAgICBkb20uYXBwZW5kQ2hpbGQoIHRoaXMucmVuZGVyZXIuZG9tRWxlbWVudCApO1xyXG4gICAgdGhpcy5yZXNpemUoKTtcclxuXHJcbiAgfVxyXG5cclxuICByZXNpemUoKSB7XHJcblxyXG4gICAgdGhpcy5yZW5kZXJlci5zZXRTaXplKCB3aW5kb3cuaW5uZXJXaWR0aCwgd2luZG93LmlubmVySGVpZ2h0ICk7XHJcblxyXG4gIH1cclxuXHJcbiAgcmVuZGVyKCkge1xyXG5cclxuICAgIHRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnb25QcmVSZW5kZXInIH0gKTtcclxuICAgIHRoaXMucmVuZGVyZXIucmVuZGVyKCB0aGlzLnNjZW5lLCB0aGlzLmNhbWVyYSApO1xyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSggdGhpcy5yZW5kZXIuYmluZCggdGhpcyApICk7XHJcblxyXG4gIH1cclxuXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gV2luZG93TWFuYWdlcjtcclxuIiwibGV0XHJcbkdhbWUgPSByZXF1aXJlKCAnLi9nYW1lL0dhbWUuanMnICk7XHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG5cclxuICAndXNlIHN0cmljdCc7XHJcblxyXG4gIHZhciBnYW1lID0gbmV3IEdhbWUoKTtcclxuXHJcbn0pKCk7XHJcbiIsIi8qKlxyXG4gKiBAYXV0aG9yIG1yZG9vYiAvIGh0dHA6Ly9tcmRvb2IuY29tL1xyXG4gKi9cclxuXHJcbmZ1bmN0aW9uIEV2ZW50RGlzcGF0Y2hlcigpIHt9XHJcblxyXG5PYmplY3QuYXNzaWduKCBFdmVudERpc3BhdGNoZXIucHJvdG90eXBlLCB7XHJcblxyXG5cdGFkZEV2ZW50TGlzdGVuZXI6IGZ1bmN0aW9uICggdHlwZSwgbGlzdGVuZXIgKSB7XHJcblxyXG5cdFx0aWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHRoaXMuX2xpc3RlbmVycyA9IHt9O1xyXG5cclxuXHRcdHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7XHJcblxyXG5cdFx0aWYgKCBsaXN0ZW5lcnNbIHR5cGUgXSA9PT0gdW5kZWZpbmVkICkge1xyXG5cclxuXHRcdFx0bGlzdGVuZXJzWyB0eXBlIF0gPSBbXTtcclxuXHJcblx0XHR9XHJcblxyXG5cdFx0aWYgKCBsaXN0ZW5lcnNbIHR5cGUgXS5pbmRleE9mKCBsaXN0ZW5lciApID09PSAtIDEgKSB7XHJcblxyXG5cdFx0XHRsaXN0ZW5lcnNbIHR5cGUgXS5wdXNoKCBsaXN0ZW5lciApO1xyXG5cclxuXHRcdH1cclxuXHJcblx0fSxcclxuXHJcblx0aGFzRXZlbnRMaXN0ZW5lcjogZnVuY3Rpb24gKCB0eXBlLCBsaXN0ZW5lciApIHtcclxuXHJcblx0XHRpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIGZhbHNlO1xyXG5cclxuXHRcdHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7XHJcblxyXG5cdFx0cmV0dXJuIGxpc3RlbmVyc1sgdHlwZSBdICE9PSB1bmRlZmluZWQgJiYgbGlzdGVuZXJzWyB0eXBlIF0uaW5kZXhPZiggbGlzdGVuZXIgKSAhPT0gLSAxO1xyXG5cclxuXHR9LFxyXG5cclxuXHRyZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAoIHR5cGUsIGxpc3RlbmVyICkge1xyXG5cclxuXHRcdGlmICggdGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSByZXR1cm47XHJcblxyXG5cdFx0dmFyIGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVycztcclxuXHRcdHZhciBsaXN0ZW5lckFycmF5ID0gbGlzdGVuZXJzWyB0eXBlIF07XHJcblxyXG5cdFx0aWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7XHJcblxyXG5cdFx0XHR2YXIgaW5kZXggPSBsaXN0ZW5lckFycmF5LmluZGV4T2YoIGxpc3RlbmVyICk7XHJcblxyXG5cdFx0XHRpZiAoIGluZGV4ICE9PSAtIDEgKSB7XHJcblxyXG5cdFx0XHRcdGxpc3RlbmVyQXJyYXkuc3BsaWNlKCBpbmRleCwgMSApO1xyXG5cclxuXHRcdFx0fVxyXG5cclxuXHRcdH1cclxuXHJcblx0fSxcclxuXHJcblx0ZGlzcGF0Y2hFdmVudDogZnVuY3Rpb24gKCBldmVudCApIHtcclxuXHJcblx0XHRpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuO1xyXG5cclxuXHRcdHZhciBsaXN0ZW5lcnMgPSB0aGlzLl9saXN0ZW5lcnM7XHJcblx0XHR2YXIgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1sgZXZlbnQudHlwZSBdO1xyXG5cclxuXHRcdGlmICggbGlzdGVuZXJBcnJheSAhPT0gdW5kZWZpbmVkICkge1xyXG5cclxuXHRcdFx0ZXZlbnQudGFyZ2V0ID0gdGhpcztcclxuXHJcblx0XHRcdHZhciBhcnJheSA9IGxpc3RlbmVyQXJyYXkuc2xpY2UoIDAgKTtcclxuXHJcblx0XHRcdGZvciAoIHZhciBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7XHJcblxyXG5cdFx0XHRcdGFycmF5WyBpIF0uY2FsbCggdGhpcywgZXZlbnQgKTtcclxuXHJcblx0XHRcdH1cclxuXHJcblx0XHR9XHJcblxyXG5cdH1cclxuXHJcbn0gKTtcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gRXZlbnREaXNwYXRjaGVyO1xyXG4iXX0="}